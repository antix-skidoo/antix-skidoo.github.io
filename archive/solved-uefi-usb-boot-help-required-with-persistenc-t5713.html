<!DOCTYPE html>
<html dir="ltr" lang="en-gb">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" />
<title>[SOLVED]UEFI USB Boot Help required with persistence - antiX oldforums archive</title>
     

<link rel="stylesheet" href="../aaa_style.css">
</head>
<body>

<div id="wrap" class="wrap">
<a id="top" class="top-anchor" accesskey="t"></a>

<div id="inner-wrap">

<li class="scroll-breadcrumbs breadcrumbs">
<span class="crumb"><a href="./index.html" accesskey="h" data-navbar-reference="index"><span>antiX oldforumums archive</span></a>
 &raquo; &raquo; 
</span>
<span class="crumb"><a href="./official-releases-f42/index.html"><span>Official releases</span></a>
 &raquo; &raquo; 
</span>
<span class="crumb"><a href="./antix-15-killah-p-f53/index.html"><span>antiX-15 Killah P</span></a></span>
</li>
</ul>

<div id="page-body" class="page-body" role="main">
<div class="postprofile_container postprofile_Left">
<div>
<h2 class="topic-title" style="display: inline-block;"><a href="./solved-uefi-usb-boot-help-required-with-persistenc-t5713.html">[SOLVED]UEFI USB Boot Help required with persistence</a></h2>
<div class="pagination">
11 posts
&bull; Page <strong>1</strong> of <strong>1</strong>
</div>
</div>

<div class="action-bar bar-top">
</div>
<div class="viewtopic_wrapper">
<div id="p_41663" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile41663">
<dt class="no-profile-rank has-avatar avatar-username">
<dd class="detail-title-numposts">Posts: 15</dd>
<span class="username">kagashe</span>
</dt>
<dd class="profile-joined">Joined: 19 Feb 2009</dd>
</dl>
<div class="postbody">
<div id="post_content41663">

<time datetime="2015-07-02T12:12">posted: 2015-07-02  &nbsp; 12:12</time>
<span class="permalink"><a href="./solved-uefi-usb-boot-help-required-with-persistenc-t5713.html#p41663" title="permalink">#1</a></span>

<div class="content">I posted this morning in New User Forum but now posting here since it pertains to antiX-15.<br>
<br>
Let me congratulate first anticapitalista for giving new version which can boot on UEFI with Secure Boot on.<br>
<br>
I had mounted the iso and copied the contents to the usb.<br>
<br>
I would like to report that only the first option on boot menu works for me and the second option with menus does not work. I waited a few minutes and had to long press the power button.<br>
<br>
I tried persist=root!,home as well as persist=root! alone but it takes indefinite time to create the required files and I had to again long press the power button.<br>
<br>
I think either the above cheatcode is not applicable for this version or it does not work on my system.<br>
<br>
Kamalakar</div>

<div class="notice">
Last edited by <b>kagashe</b> on 03 Jul 2015, 05:38, edited 1 time in total.
</div>

</div>
</div>

</div>
</div>
<div id="p_41665" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile41665">
<dt class="has-profile-rank has-avatar avatar-username">
<span class="username">anticapitalista</span>
<div class="avatar-username-inner">
<dd class="detail-title-numposts">Posts: 5,959</dd>
</div>
</dt>
<dd class="profile-rank">Site Admin</dd>
<dd class="profile-joined">Joined: 11 Sep 2007</dd>
</dl>
<div class="postbody">
<div id="post_content41665">

<time datetime="2015-07-02T13:05">posted: 2015-07-02  &nbsp; 13:05</time>
<span class="permalink"><a href="./solved-uefi-usb-boot-help-required-with-persistenc-t5713.html#p41665" title="permalink">#2</a></span>

<div class="content">BitJam did warn that it takes a LONG time to create the rootfs and homefs persistence files on fat32.</div>

</div>
</div>
 
</div>
</div>
<div id="p_41669" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile41669">
<dt class="no-profile-rank has-avatar avatar-username">
<dd class="detail-title-numposts">Posts: 15</dd>
<span class="username">kagashe</span>
</dt>
<dd class="profile-joined">Joined: 19 Feb 2009</dd>
</dl>
<div class="postbody">
<div id="post_content41669">

<time datetime="2015-07-02T13:13">posted: 2015-07-02  &nbsp; 13:13</time>
<span class="permalink"><a href="./solved-uefi-usb-boot-help-required-with-persistenc-t5713.html#p41669" title="permalink">#3</a></span>

<div class="content"><blockquote><div><cite>anticapitalista wrote:</cite>BitJam did warn that it takes a LONG time to create the rootfs and homefs persistence files on fat32.</div></blockquote>How long?<br>
<br>
I also created ext4 partition, shifted linuxfs in /antiX folder on that partition but it took very long.<br>
<br>
By the way I can create these files with dd before booting, please tell me the location. I would like to use ext4 partition.<br>
<br>
Kamalakar</div>

</div>
</div>

</div>
</div>
<div id="p_41672" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile41672">
<dt class="no-profile-rank has-avatar avatar-username">
<dd class="detail-title-numposts">Posts: 2,238</dd>
<span class="username">dolphin_oracle</span>
</dt>
<dd class="profile-joined">Joined: 16 Dec 2007</dd>
</dl>
<div class="postbody">
<div id="post_content41672">

<time datetime="2015-07-02T13:48">posted: 2015-07-02  &nbsp; 13:48</time>
<span class="permalink"><a href="./solved-uefi-usb-boot-help-required-with-persistenc-t5713.html#p41672" title="permalink">#4</a></span>

<div class="content">On my system, with a fat32 partition, it takes about 7 minutes to make a 1gb persistence file.</div>

</div>
</div>

</div>
</div>
<div id="p_41676" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile41676">
<dt class="no-profile-rank has-avatar avatar-username">
<dd class="detail-title-numposts">Posts: 1,308</dd>
<span class="username">BitJam</span>
</dt>
<dd class="profile-joined">Joined: 31 Aug 2009</dd>
</dl>
<div class="postbody">
<div id="post_content41676">

<time datetime="2015-07-02T17:02">posted: 2015-07-02  &nbsp; 17:02</time>
<span class="permalink"><a href="./solved-uefi-usb-boot-help-required-with-persistenc-t5713.html#p41676" title="permalink">#5</a></span>

<div class="content"><blockquote><div><cite>kagashe wrote:</cite>I also created ext4 partition, shifted linuxfs in /antiX folder on that partition but it took very long.</div></blockquote>My guess is that even though you copied the linuxfs file to the ext4 partition, you didn't erase the copy that was on the fat32 partition.
<blockquote class="uncited"><div>By the way I can create these files with dd before booting, please tell me the location. I would like to use ext4 partition.</div></blockquote>The rootfs and homefs files end up alongside the linuxfs file so they will all be in the /antiX directory.<br>
<br>
BUT, if you don't fix the problem of removing the linuxfs file from the fat32 partition then that location will be used. Or, perhaps worse, one will be used on some boots and the other will be used on other boots.</div>

</div>
</div>

</div>
</div>
<div id="p_41703" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile41703">
<dt class="no-profile-rank has-avatar avatar-username">
<dd class="detail-title-numposts">Posts: 15</dd>
<span class="username">kagashe</span>
</dt>
<dd class="profile-joined">Joined: 19 Feb 2009</dd>
</dl>
<div class="postbody">
<div id="post_content41703">

<time datetime="2015-07-03T02:26">posted: 2015-07-03  &nbsp; 02:26</time>
<span class="permalink"><a href="./solved-uefi-usb-boot-help-required-with-persistenc-t5713.html#p41703" title="permalink">#6</a></span>

<div class="content"><blockquote><div><cite>BitJam wrote:</cite><blockquote><div><cite>kagashe wrote:</cite>I also created ext4 partition, shifted linuxfs in /antiX folder on that partition but it took very long.</div></blockquote>My guess is that even though you copied the linuxfs file to the ext4 partition, you didn't erase the copy that was on the fat32 partition.
<blockquote class="uncited"><div>By the way I can create these files with dd before booting, please tell me the location. I would like to use ext4 partition.</div></blockquote>The rootfs and homefs files end up alongside the linuxfs file so they will all be in the /antiX directory.<br>
<br>
BUT, if you don't fix the problem of removing the linuxfs file from the fat32 partition then that location will be used. Or, perhaps worse, one will be used on some boots and the other will be used on other boots.</div></blockquote>
No, I did not copy but moved linuxfs.<br>
<br>
I created rootfs and homefs following the instructions 
<br>========= SCRAPER REMOVED AN EMBEDDED LINK HERE ===========<br>url was:"http://download.tuxfamily.org/antix/docs-antiX-13/live-boot/persistence.html#_creating_persistence_files"<br>linktext was:"here"<br>====================================<br>

<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>dd if=/dev/zero of=rootfs bs=1M count=0 seek=1024
mkfs.ext4 -q -m 0 -O ^has_journal -F rootfs</code></pre></div>Same for homefs.<br>
<br>
Even then I can't boot with persist=root!,home<br>
<br>
I have waited for half an hour, the screen is blank and I have to long press the power button.<br>
<br>
I have also tried booting with toram and use unetbootin and antiXtousb to make the usb stick using antiX but it does not work.<br>
<br>
Kamalakar</div>

</div>
</div>

</div>
</div>
<div id="p_41704" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile41704">
<dt class="no-profile-rank has-avatar avatar-username">
<dd class="detail-title-numposts">Posts: 1,308</dd>
<section class="desktop-hide">
<div class="avatar-container">
<a href="#" class="avatar"><i class="avatar-bg" style=background-image:url(https://groups.tapatalk-cdn.com/avatar/173/756_1510233233.png)></i></a>  </div>
<a href="#" class="username">BitJam</a> </section>
</dt>
<dd class="profile-joined">Joined: 31 Aug 2009</dd>
</dl>
<div class="postbody">
<div id="post_content41704">

<time datetime="2015-07-03T03:01">posted: 2015-07-03  &nbsp; 03:01</time>
<span class="permalink"><a href="./solved-uefi-usb-boot-help-required-with-persistenc-t5713.html#p41704" title="permalink">#7</a></span>

<div class="content"><blockquote><div><cite>kagashe wrote:</cite>Even then I can't boot with persist=root!,home</div></blockquote>
So it boots okay if you don't use"persist=root!,home" but when you do use it you get a blank screen? When does this happen? Right after you press &lt;Enter&gt; in the grub2 menu? Is the grub2 menu the last thing you see?<br>
<br>
You should also be able to enable persistence if you use the"menus" boot option but maybe you had a problem with this as well.</div>

</div>
</div>

</div>
</div>
<div id="p_41706" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile41706">
<dt class="no-profile-rank has-avatar avatar-username">
<dd class="detail-title-numposts">Posts: 15</dd>
<span class="username">kagashe</span>
</dt>
<dd class="profile-joined">Joined: 19 Feb 2009</dd>
</dl>
<div class="postbody">
<div id="post_content41706">

<time datetime="2015-07-03T03:38">posted: 2015-07-03  &nbsp; 03:38</time>
<span class="permalink"><a href="./solved-uefi-usb-boot-help-required-with-persistenc-t5713.html#p41706" title="permalink">#8</a></span>

<div class="content"><blockquote><div><cite>BitJam wrote:</cite><blockquote><div><cite>kagashe wrote:</cite>Even then I can't boot with persist=root!,home</div></blockquote>
So it boots okay if you don't use"persist=root!,home" but when you do use it you get a blank screen? When does this happen? Right after you press &lt;Enter&gt; in the grub2 menu? Is the grub2 menu the last thing you see?<br>
<br>
You should also be able to enable persistence if you use the"menus" boot option but maybe you had a problem with this as well.</div></blockquote>Yes it boots ok without persist, Blank screen is there for a few seconds, then I see boot text. With persist option the blank screen stays there for ever. <br>
<br>
The menus boot option is not working.<br>
<br>
Kamalakar</div>

</div>
</div>

</div>
</div>
<div id="p_41707" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile41707">
<dt class="no-profile-rank has-avatar avatar-username">
<dd class="detail-title-numposts">Posts: 1,308</dd>
<span class="username">BitJam</span>
</dt>
<dd class="profile-joined">Joined: 31 Aug 2009</dd>
</dl>
<div class="postbody">
<div id="post_content41707">

<time datetime="2015-07-03T03:55">posted: 2015-07-03  &nbsp; 03:55</time>
<span class="permalink"><a href="./solved-uefi-usb-boot-help-required-with-persistenc-t5713.html#p41707" title="permalink">#9</a></span>

<div class="content">I looked at the /boot/grub/grub.cfg file in the antiX-15 iso file and I noticed that it uses:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>gfxpayload=text</code></pre></div>
Please edit this file and change these to:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>gfxpayload=keep</code></pre></div>and see if that makes an improvement.<br>
<br>
I *think* we were planning to make that change but it never got checked. The 
<br>========= SCRAPER REMOVED AN EMBEDDED LINK HERE ===========<br>url was:"https://www.gnu.org/software/grub/manual/html_node/gfxpayload.html"<br>linktext was:"documentation"<br>====================================<br>
 for that parameter is not great:<blockquote class="uncited"><div>Depending on your kernel, your distribution, your graphics card, and the phase of the moon, note that using this option may cause GNU/Linux to suffer from various display problems, particularly during the early part of the boot sequence. If you have problems, set this variable to ‘text’ and GRUB will tell Linux to boot in normal text mode. </div></blockquote>
It's quite possible that having it set to"text" is what is causing your problems. IIRC I originally set it to"text" thinking that was the safest thing to do (as per the documentation) but I think we had better luck with"keep".<br>
<br>
The only thing I can think of that would link"persist=root!,home" to a blank screen at the beginning of the boot process is the exlaimation point. If you have already created the rootfs and homefs files then you don't need it. You can try removing it and see if things work better.<br>
<br>
You say the menus boot option is not working. Does this mean you get a blank screen right when the boot starts just like with"persist=root!,home"?</div>

</div>
</div>

</div>
</div>
<div id="p_41708" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile41708">
<dt class="no-profile-rank has-avatar avatar-username">
<dd class="detail-title-numposts">Posts: 15</dd>
<span class="username">kagashe</span>
</dt>
<dd class="profile-joined">Joined: 19 Feb 2009</dd>
</dl>
<div class="postbody">
<div id="post_content41708">

<time datetime="2015-07-03T05:35">posted: 2015-07-03  &nbsp; 05:35</time>
<span class="permalink"><a href="./solved-uefi-usb-boot-help-required-with-persistenc-t5713.html#p41708" title="permalink">#10</a></span>

<div class="content"><blockquote><div><cite>BitJam wrote:</cite>I looked at the /boot/grub/grub.cfg file in the antiX-15 iso file and I noticed that it uses:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>gfxpayload=text</code></pre></div>
Please edit this file and change these to:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>gfxpayload=keep</code></pre></div>and see if that makes an improvement.<br>
<br>
I *think* we were planning to make that change but it never got checked. The 
<br>========= SCRAPER REMOVED AN EMBEDDED LINK HERE ===========<br>url was:"https://www.gnu.org/software/grub/manual/html_node/gfxpayload.html"<br>linktext was:"documentation"<br>====================================<br>
 for that parameter is not great:<blockquote class="uncited"><div>Depending on your kernel, your distribution, your graphics card, and the phase of the moon, note that using this option may cause GNU/Linux to suffer from various display problems, particularly during the early part of the boot sequence. If you have problems, set this variable to ‘text’ and GRUB will tell Linux to boot in normal text mode. </div></blockquote>
It's quite possible that having it set to"text" is what is causing your problems. IIRC I originally set it to"text" thinking that was the safest thing to do (as per the documentation) but I think we had better luck with"keep".<br>
<br>
The only thing I can think of that would link"persist=root!,home" to a blank screen at the beginning of the boot process is the exlaimation point. If you have already created the rootfs and homefs files then you don't need it. You can try removing it and see if things work better.<br>
<br>
You say the menus boot option is not working. Does this mean you get a blank screen right when the boot starts just like with"persist=root!,home"?</div></blockquote>
I think following was the problem:
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>gfxpayload=text</code></pre></div>Although it worked without persist<br>
chnaging it to:
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>gfxpayload=keep</code></pre></div>worked for persist=root!,home<br>
<br>
My usb is only 4 GB and I think the default setting for rootfs, homefs may quiet high for this drive.<br>
Since I had already created rootfs, homefs of 1 GB each it worked.<br>
<br>
Menu boot option also works with gfxpayload=keep<br>
This thread is SOLVED.<br>
<br>
Kamalakar</div>

</div>
</div>

</div>
</div>
<div id="p_41711" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile41711">
<dt class="no-profile-rank has-avatar avatar-username">
<dd class="detail-title-numposts">Posts: 1,308</dd>
<span class="username">BitJam</span>
</dt>
<dd class="profile-joined">Joined: 31 Aug 2009</dd>
</dl>
<div class="postbody">
<div id="post_content41711">

<time datetime="2015-07-03T06:36">posted: 2015-07-03  &nbsp; 06:36</time>
<span class="permalink"><a href="./solved-uefi-usb-boot-help-required-with-persistenc-t5713.html#p41711" title="permalink">#11</a></span>

<div class="content">I'm glad you got it to work. Thanks for hanging in there. I will be sure to change"text" to"keep" in the next release. I'm sorry for all the difficulty you had.
<blockquote class="uncited"><div>My usb is only 4 GB and I think the default setting for rootfs, homefs may quiet high for this drive.<br>
Since I had already created rootfs, homefs of 1 GB each it worked.</div></blockquote>The default choices for the sizes (in the initrd) scale with the amount of space available. I wrote a little script to see what sizes it would suggest based on the size of the usb drive and assuming the all the other files take up 700M. Here are some results:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>  disk size  available     rootfs     homefs  remaining
        1G        300          0        300           
        2G       1300        700          0        600
        4G       3300       1700        475       1125
        8G       7300       2000       1400       3900
       16G      15300       2000       3400       9900
       32G      31300       2000       4000      25300</code></pre></div>
I think your choice of 1G and 1G was good. Sometimes when you do a big apt-get upgrade, you may need more than 1G for the rootfs file. If you have enough RAM then try to do a live-remaster right after a big apt-get upgrade in order to consolidate the files system changes into a compressed linuxfs file. Unfortunately, this also takes up a lot of space on your LiveUSB since you need enough space for the old linuxfs file and the new one. <br>
<br>
BTW: when I make a LiveUSB for myself, I use the following options for mkfs.ext4:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>mkfs.ext4 -m0 -N2000 -J size=16 -L antiX-15 /dev/$USB_DEVICE</code></pre></div>This can give you more room to work with. It is based on the idea that even though there are many files inside of the linuxfs file and there can be many files inside of the rootfs and homefs files, there are not many files on the LiveUSB filesystem so the default number of inodes (based on the size of the LiveUSB) is way overkill.<br>
<br>
I also keep journaling enabled even though this is not optimal for speed or for wear. I do it because it is so darned easy to accidentally unplug a LiveUSB when it is working. We've had users who have had data loss due to using ext2 on their LiveUSB. There are certainly situations where disabling journaling is the best choice (especially of you don't mind data loss) but I think ext4 with journaling is now the best default for usb sticks.<br>
<br>
Again, I'm sorry for all the trouble you had. If you have any other problems or questions, please feel free to ask.</div>

</div>
</div>

</div>
</div>

</div>
<div class="action-bar bar-bottom">
<div class="pagination">
11 posts
&bull; Page <strong>1</strong> of <strong>1</strong>
</div>
</div>
</div>

<div class="scrollToTopText"><a href="#top">Back to top</a></div> </div>
</div>

</div>
</body></html>
