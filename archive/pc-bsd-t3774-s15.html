<!DOCTYPE html>
<html dir="ltr" lang="en-gb">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" />
<title>PC-BSD - Page 2 - antiX oldforums archive</title>
   
<link rel="stylesheet" href="../aaa_style.css">
<script type="text/javascript" src ="../aaa_oldforums.js"></script>
</head>
<body>
<div id="wrap" class="wrap">
<a id="top" class="top-anchor" accesskey="t"></a>

<div id="inner-wrap">
<ul id="nav-breadcrumbs" class="nav-breadcrumbs linklist navlinks clear-after" role="menubar">
<li class="scroll-breadcrumbs breadcrumbs">
<span class="crumb"><a href="./index.html" accesskey="h" data-navbar-reference="index"><span>antiX - oldforums archive</span></a> &raquo;&raquo; </span>

<span class="crumb"><a href="./general-f21/index.html"><span>General</span></a> &raquo;&raquo; </span>

<span class="crumb"><a href="./other-distros-f41/index.html"><span>Other distros</span></a></span>
</li>
</ul>

<div id="page-body" class="page-body" role="main">
<div class="postprofile_container postprofile_Left">
<div>
<div class="topictitleheader"><span class="statictopictitle">topic title: </span><span class="topic-titleb"><a href="./pc-bsd-t3774-s15.html">PC-BSD</a></div>
<div class="pagination">
26 posts
<ul>
<li class="arrow previous"><span class="jumptopagez">jump to page: </span><a class="button button-icon-only" href="./pc-bsd-t3774.html" rel="prev" role="button"><span class="sr-only">Previous</span></a></li>
<li><a class="button" href="./pc-bsd-t3774.html" role="button">1</a></li>
<li class="active"><span>2</span></li>
</ul>
</div>
</div>


<div class="viewtopic_wrapper">
<div id="p_25430" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile25430">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 279</span></div>

</div>
</div>
<span class="username">afab4</span>
</dt>
<dd class="profile-joined">Joined: 17 Oct 2009</dd>
</dl>
<div class="postbody">
<div id="post_content25430">
<time datetime="2012-07-18T17:53">posted: 2012-07-18 &nbsp; 17:53</time>
<span class="permalink"><a href="./pc-bsd-t3774-s15.html#p25430" title="permalink">#16</a></span>

<div class="content"><blockquote><div><cite>anticapitalista wrote:</cite>Yes, cpulimit was mentioned before, but I forgot about it <span class="emoticon"> __{{emoticon}}__ </span><br>
<br>
This seems to be working.<br>
<br>
#cpulimit --exe mksquashfs --limit 40<br>
<br>
and then run mksquashfs<br>
<br>
The main reason to reduce CPU is due to heat on laptops. I think this option is better than using a bag of ice cubes <span class="emoticon"> __{{emoticon}}__ </span></div></blockquote>
Can this be added to the antixsnapshot script?<br>
YES much better than setting my laptop on ice or setting it in the freezer <span class="emoticon"> __{{emoticon}}__ </span></div>
</div>
</div>

</div>
</div>
<div id="p_25431" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile25431">
<dt class="has-profile-rank has-avatar avatar-username">
<span class="username">anticapitalista</span>
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 5,955</span></div>

</div>
</div>
</dt>
<dd class="profile-rank">Site Admin</dd>
<dd class="profile-joined">Joined: 11 Sep 2007</dd>
</dl>
<div class="postbody">
<div id="post_content25431">

<time datetime="2012-07-18T18:02">posted: 2012-07-18 &nbsp; 18:02</time>
<span class="permalink"><a href="./pc-bsd-t3774-s15.html#p25431" title="permalink">#17</a></span>

<div class="content">It doesn't seem to work within the script as cpulimit needs to be run in parallel or just before mksquashfs is called. But I'll try it again)<br>
<br>
Maybe one of the real gurus could suggest a way for this to happen.<br>
<br>
BTW cpulimit --exe mksquashfs --limit 40 makes it very, very slow.<br>
<br>
User should play with the numbers.<br>
<br>
Some users may not want cpulimit running, so I guess it sgould be an option in the etc/antixsnapshot file and also the setting of the --limit value.</div>
</div>
</div>

</div>
</div>
<div id="p_25432" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile25432">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 1,062</span></div>

</div>
</div>
<span class="username">Dave</span>
</dt>
<dd class="profile-joined">Joined: 20 Jan 2010</dd>
</dl>
<div class="postbody">
<div id="post_content25432">

<time datetime="2012-07-18T18:21">posted: 2012-07-18 &nbsp; 18:21</time>
<span class="permalink"><a href="./pc-bsd-t3774-s15.html#p25432" title="permalink">#18</a></span>

<div class="content">maybe a yad wrapper script?<br>
something like:
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>amount=`yad --scale\
 --min-value="40"\
 --max-value="100"\
 --value="70"\
 --text="Select the amount in of cpu\n you would like to use"\
 --button="gtk-ok:0"`; 
cpulimit --exe mksquashfs --limit $amount ;
[\code]

and then run the wrapper script from antix snapshot with nohup?</code></pre></div></div>
</div>
</div>

</div>
</div>
<div id="p_25433" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile25433">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 279</span></div>

</div>
</div>
<span class="username">afab4</span>
</dt>
<dd class="profile-joined">Joined: 17 Oct 2009</dd>
</dl>
<div class="postbody">
<div id="post_content25433">

<time datetime="2012-07-18T19:29">posted: 2012-07-18 &nbsp; 19:29</time>
<span class="permalink"><a href="./pc-bsd-t3774-s15.html#p25433" title="permalink">#19</a></span>

<div class="content"><blockquote><div><cite>anticapitalista wrote:</cite>Yes, cpulimit was mentioned before, but I forgot about it <span class="emoticon"> __{{emoticon}}__ </span><br>
<br>
This seems to be working.<br>
<br>
#cpulimit --exe mksquashfs --limit 40<br>
<br>
and then run mksquashfs<br>
<br>
The main reason to reduce CPU is due to heat on laptops. I think this option is better than using a bag of ice cubes <span class="emoticon"> __{{emoticon}}__ </span></div></blockquote>
<br>
Okay, I installed cpulimit and then ran
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>cpulimit --exe mksquashfs --limit 40 antixsnapshot
</code></pre></div>
and it ran ok, no heat problems albeit slow.<br>
<br>
So I changed the setting to 70 first, then 50 and the process took off hell bent both times and I couldn't shut it down. I finally had to power down my laptop.<br>
Am I doing something wrong the way I am calling antixsnapshot?</div>

</div>
</div>

</div>
</div>
<div id="p_25434" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile25434">
<dt class="has-profile-rank has-avatar avatar-username">
<span class="username">anticapitalista</span>
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 5,955</span></div>

</div>
</div>
</dt>
<dd class="profile-rank">Site Admin</dd>
<dd class="profile-joined">Joined: 11 Sep 2007</dd>
</dl>
<div class="postbody">
<div id="post_content25434">

<time datetime="2012-07-18T20:05">posted: 2012-07-18 &nbsp; 20:05</time>
<span class="permalink"><a href="./pc-bsd-t3774-s15.html#p25434" title="permalink">#20</a></span>

<div class="content">Try this.<br>
<br>
#cpulimit --exe antixsnapshot --limit 40<br>
<br>
Then open antixsnapshot in a terminal and htop to see if all is ok.<br>
<br>
Added: Unfortunately, on its own, the above is ok for the beginning ie when rsync copies the files, but when mksquashfs takes over to make the compressed file system, CPU goes up so you need to open another root terminal as type<br>
<br>
#cpulimit --exe mksquashfs --limit 40<br>
<br>
There must be a better way. Time for me to rtfm.</div>
</div>
</div>

</div>
</div>
<div id="p_25439" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile25439">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 279</span></div>

</div>
</div>
<span class="username">afab4</span>
</dt>
<dd class="profile-joined">Joined: 17 Oct 2009</dd>
</dl>
<div class="postbody">
<div id="post_content25439">

<time datetime="2012-07-19T22:59">posted: 2012-07-19 &nbsp; 22:59</time>
<span class="permalink"><a href="./pc-bsd-t3774-s15.html#p25439" title="permalink">#21</a></span>

<div class="content"><blockquote><div><cite>anticapitalista wrote:</cite>
<br>
There must be a better way. Time for me to rtfm.</div></blockquote>
anti.<br>
I blacklisted rsync, mksquashfs and genisoimage in the cpulimit_ daemon.sh and changed to 80 percent as you did. Works well. No overheating at this level on my laptop. antixsnapshot does take longer to complete but it is a good trade off.<br>
I am using 43-52 % CPU and temperature 150-175 F so that is very good.<br>
One thing i noticed was when I just added mksquashfs to the blacklist I seemed to use a few more MB at idle.<br>
With all 3 processes added my idle MB actually dropped about 3 MB. So I am just going to let the daemon run all the time.</div>
</div>
</div>

</div>
</div>
<div id="p_25454" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile25454">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 9</span></div>

</div>
</div>
<span class="username">fsmithred</span>
</dt>
<dd class="profile-joined">Joined: 02 Oct 2011</dd>
</dl>
<div class="postbody">
<div id="post_content25454">

<time datetime="2012-07-22T18:21">posted: 2012-07-22 &nbsp; 18:21</time>
<span class="permalink"><a href="./pc-bsd-t3774-s15.html#p25454" title="permalink">#22</a></span>

<div class="content">Here's a script I've used along with refractasnapshot to limit cpu usage for rsync. It uses the pid, so it has to be started after rsync starts. Maybe it'll give someone ideas.
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>#!/usr/bin/env bash

for i in $(pgrep rsync); do
    sudo cpulimit -e rsync -l 50 &amp;
done

echo"cpulimit"
ps ax |grep cpulimit
echo"rsync"
ps ax | grep rsync
echo"@@@@@"

sleep 360

if $(ps ax | grep -q mksquashfs); then
    sudo pkill cpulimit
fi

echo"#####"
ps ax | grep cpulimit
echo"#####"

exit 0
</code></pre></div></div>
</div>
</div>

</div>
</div>
<div id="p_25468" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile25468">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">

<span> <strong><span class="username">nadir</span></strong> </span>
<div class="thread-user-detail">
<table>
<tr>
<td valign="top" class="detail-title"><a><span>Posts</span></a></td>
<td valign="top" class="detail-value"><span>0</span></td>
</tr>
</table>

</div>
</div>
<section class="desktop-hide">

<strong><span class="username">nadir</span></strong> </section>
</dt>
</dl>
<div class="postbody">
<div id="post_content25468">

<time datetime="2012-07-24T01:03">posted: 2012-07-24 &nbsp; 01:03</time>
<span class="permalink"><a href="./pc-bsd-t3774-s15.html#p25468" title="permalink">#23</a></span>

<div class="content"><blockquote><div><cite>meandean wrote:</cite>Heck I think the basic bash commands were the easy part. The others did the complicated part... <span class="emoticon"> __{{emoticon}}__ </span></div></blockquote>
<br>
Dare i refresh your memory a bit? I recall a very old thread at a forum called cloudywizzard (?) where you explained how to use live-helper to BroTiag (and over several pages, with loads of questions and miracles). Back in those times it was a pain to get squash running (fiddling with kernel modules and what not). Then you posted that at forums.debian, and then came how-to's bout how to create something like a snapshot:"lh config --bootstrap copy" (and then, finally, something with bash commands).<br>
<br>
So no: it was not the easy part, as far i can tell. I can't count the times where i linked to one of those how-to's. Not saying that the other things are not difficult (au contraire).<br>
end off-topic.</div>
</div>
</div>

</div>
</div>
<div id="p_25475" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile25475">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 15</span></div>

</div>
</div>
<span class="username">meandean</span>
</dt>
<dd class="profile-joined">Joined: 14 Jul 2012</dd>
</dl>
<div class="postbody">
<div id="post_content25475">

<time datetime="2012-07-24T16:48">posted: 2012-07-24 &nbsp; 16:48</time>
<span class="permalink"><a href="./pc-bsd-t3774-s15.html#p25475" title="permalink">#24</a></span>

<div class="content"><blockquote><div><cite>nadir wrote:</cite> <br>
Dare i refresh your memory a bit?</div></blockquote>
refresh away <span class="emoticon"> __{{emoticon}}__ </span> <br>
<br>
I guess I should clarify. Coming up with the process/commands was the fun part. Some trial and error, some experimentation, and some testing. That for me is the easy part. The programing part....not so much.</div>
</div>
</div>

</div>
</div>
<div id="p_25477" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile25477">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">

<span> <strong><span class="username">nadir</span></strong> </span>
<div class="thread-user-detail">
<table>
<tr>
<td valign="top" class="detail-title"><a><span>Posts</span></a></td>
<td valign="top" class="detail-value"><span>0</span></td>
</tr>
</table>

</div>
</div>
<section class="desktop-hide">

<strong><span class="username">nadir</span></strong> </section>
</dt>
</dl>
<div class="postbody">
<div id="post_content25477">

<time datetime="2012-07-24T17:03">posted: 2012-07-24 &nbsp; 17:03</time>
<span class="permalink"><a href="./pc-bsd-t3774-s15.html#p25477" title="permalink">#25</a></span>

<div class="content">ah, i see. <br>
Yes, with that i agree. fsmithred has fiddled more than just a bit with it (most of it is beyond me... but i got the general idea. I hope <span class="emoticon"> __{{emoticon}}__ </span> ). Yeah, scripting/programming is strange.<br>
To me it _looks like in a script 10% is the core, and 90% percent is the safety-net (if someone runs it without having enough space, if someone runs it without being root, if, if, if .... If one assumes users know what they do lots could be skipped. But what do i know).</div>
</div>
</div>

</div>
</div>
<div id="p_33734" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile33734">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 9</span></div>

</div>
</div>
<span class="username">fsmithred</span>
</dt>
<dd class="profile-joined">Joined: 02 Oct 2011</dd>
</dl>
<div class="postbody">
<div id="post_content33734">

<time datetime="2014-03-04T00:37">posted: 2014-03-04 &nbsp; 00:37</time>
<span class="permalink"><a href="./pc-bsd-t3774-s15.html#p33734" title="permalink">#26</a></span>

<div class="content">cpulimit will run from within the script. You can start it before starting the command you want to limit, and it'll wait for it. I'll be adding the following code to the next version of refractasnapshot. I've tested this, and it works.<br>
<br>
$limit_cpu and $limit are defined in the config file.
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code># Copy the filesystem
copy_filesystem () {
if [[ $limit_cpu ="yes" ]] ; then
    cpulimit -e rsync -l"$limit" &amp;
fi
rsync -av / myfs/ --delete-excluded --exclude="$work_dir" \
 --exclude="$snapshot_dir" --exclude-from="$snapshot_excludes" \
 | tee &gt;($DIALOG --title="Copying filesystem..." --progress --pulsate --auto-close --width 300)
}

(snip)

# Squash the filesystem copy
if [[ $limit_cpu ="yes" ]] ; then
    cpulimit -e mksquashfs -l"$limit" &amp;
fi
mksquashfs myfs/ iso/live/filesystem.squashfs ${mksq_opt} \
 | tee &gt;($DIALOG --title="Squashing filesystem..." --progress --pulsate --auto-close --width 300)

pkill cpulimit

</code></pre></div></div>
</div>
</div>

</div>
</div>
</div>
<div class="action-bar bar-bottom">

<div class="pagination">
26 posts
<ul>
<li class="arrow previous"><span class="jumptopagez">jump to page: </span><a class="button button-icon-only" href="./pc-bsd-t3774.html" rel="prev" role="button"><span class="sr-only">Previous</span></a></li>
<li><a class="button" href="./pc-bsd-t3774.html" role="button">1</a></li>
<li class="active"><span>2</span></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="scrollToTopText"><a href="#top">goto top of page</a></div>

</div>
</body></html>
