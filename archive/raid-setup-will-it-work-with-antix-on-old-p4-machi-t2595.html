<!DOCTYPE html>
<html dir="ltr" lang="en-gb">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" />
<title>RAID setup -- will it work with antiX on old P4 machines? - antiX oldforums archive</title>
   
<link rel="stylesheet" href="../aaa_style.css">
<script type="text/javascript" src ="../aaa_oldforums.js"></script>
</head>
<body>
<div id="wrap" class="wrap">
<a id="top" class="top-anchor" accesskey="t"></a>

<div id="inner-wrap">
<ul id="nav-breadcrumbs" class="nav-breadcrumbs linklist navlinks clear-after" role="menubar">
<li class="scroll-breadcrumbs breadcrumbs">
<span class="crumb"><a href="./index.html" accesskey="h" data-navbar-reference="index"><span>antiX - oldforums archive</span></a> &raquo;&raquo; </span>

<span class="crumb"><a href="./orphaned-posts-f27/index.html"><span>Orphaned Posts</span></a> &raquo;&raquo; </span>

<span class="crumb"><a href="./releases-old-f44/index.html"><span>Releases (Old)</span></a> &raquo;&raquo; </span>

<span class="crumb"><a href="./antix-m8-5-marek-edelman-f40/index.html"><span>antiX-M8.5 Marek Edelman</span></a></span>
</li>
</ul>

<div id="page-body" class="page-body" role="main">
<div class="postprofile_container postprofile_Left">
<div>
<div class="topictitleheader"><span class="statictopictitle">topic title: </span><span class="topic-titleb"><a href="./raid-setup-will-it-work-with-antix-on-old-p4-machi-t2595.html">RAID setup -- will it work with antiX on old P4 machines?</a></div>
<div class="pagination">
4 posts
&bull; Page <strong>1</strong> of <strong>1</strong>
</div>
</div>

<div class="action-bar bar-top">
</div>
<div class="viewtopic_wrapper">
<div id="p_16808" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile16808">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 54</span></div>

</div>
</div>
<span class="username">SaminBare</span>
</dt>
<dd class="profile-joined">Joined: 30 May 2010</dd>
</dl>
<div class="postbody">
<div id="post_content16808">
<time datetime="2010-08-08T06:55">posted: 2010-08-08 &nbsp; 06:55</time>
<span class="permalink"><a href="./raid-setup-will-it-work-with-antix-on-old-p4-machi-t2595.html#p16808" title="permalink">#1</a></span>

<div class="content">Hoping to use SATA hard drives in old PCs, I purchased a couple VIA VT6492 RAID bus controllers 
<br>========= SCRAPER REMOVED AN EMBEDDED LINK HERE ===========<br>url was:"http://www.monoprice.com/products/product.asp?c_id=104&amp;cp_id=10407&amp;cs_id=1040702&amp;p_id=2664&amp;seq=1&amp;format=1#largeimage"<br>linktext was:"http://www.monoprice.com/products/produ ... largeimage"<br>====================================<br>
 (see below) to use with identical Seagate 80 gigers I get from a source that upgrades PCs for those that can afford to pay for labor. The card fits into a PCI slot and contains two SATA and one IDE data outputs.<br>
<br>
I was unable to get RAID up and running after putting an old AcerPower SP with Dell 250W PU machine together today. The separate BIOS of the"bootable add-in card" seems to raise havoc with config files and is not recognizable in the system BIOS, although SystemRescueCD recognizes the two connected SATA drives as /dev/sdb and /dev/sdc. Once, I got a"4941 Segmentation Fault error In Line 370 of etc/init.d/(some config file) from sysresccd <br>
I need help getting this RAID setup going, if it is feasible to begin with, that is.<br>
If not, is LVM possible with antiX?<a href="http://img405.imageshack.us/my.php?image=168340bb2c4c5872dc6bf86.jpg" class="postlink"><img src="http://img405.imageshack.us/img405/944/168340bb2c4c5872dc6bf86.th.jpg" class="postimage" alt="Image"></a></div>
<div class="notice">
Last edited by <b>SaminBare</b> on 08 Aug 2010, 16:28, edited 2 times in total.
</div>
</div>
</div>

</div>
</div>
<div id="p_16812" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile16812">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 1,520</span></div>

</div>
</div>
<span class="username">eriefisher</span>
</dt>
<dd class="profile-joined">Joined: 07 Oct 2007</dd>
</dl>
<div class="postbody">
<div id="post_content16812">

<time datetime="2010-08-08T13:46">posted: 2010-08-08 &nbsp; 13:46</time>
<span class="permalink"><a href="./raid-setup-will-it-work-with-antix-on-old-p4-machi-t2595.html#p16812" title="permalink">#2</a></span>

<div class="content">I don't think antiX will stop you from using either raid or lvm but your hardware may. If the card is not seen by the bios on powerup then the OS may not see it either. Software raid may be another option although I have never tried to set up any of them. It is something I want to do for my server so I will watch this thread.</div>
</div>
</div>

</div>
</div>
<div id="p_16825" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile16825">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 54</span></div>

</div>
</div>
<span class="username">SaminBare</span>
</dt>
<dd class="profile-joined">Joined: 30 May 2010</dd>
</dl>
<div class="postbody">
<div id="post_content16825">

<time datetime="2010-08-09T03:23">posted: 2010-08-09 &nbsp; 03:23</time>
<span class="permalink"><a href="./raid-setup-will-it-work-with-antix-on-old-p4-machi-t2595.html#p16825" title="permalink">#3</a></span>

<div class="content">I did some googling and came to the conclusion that I got what I paid for with the mentioned PCI RAID controller -- a cheap card with problems, as witnessed in the following:<br>
---------------------------------------------------------------------------<br>
1) 
<br>========= SCRAPER REMOVED AN EMBEDDED LINK HERE ===========<br>url was:"http://linux.yyz.us/why-software-raid.html"<br>linktext was:"http://linux.yyz.us/why-software-raid.html"<br>====================================<br>
<br>
<br>
* Some cards export hardware RAID capabilities, such as XOR or RAID1 offload, but allow full OS control of the operations in lieu of a firmware. Linux does not support this programming model well.<br>
--------------------------------------------------------------------------<br>
2) 
<br>========= SCRAPER REMOVED AN EMBEDDED LINK HERE ===========<br>url was:"https://bugzilla.kernel.org/show_bug.cgi?id=15173"<br>linktext was:"https://bugzilla.kernel.org/show_bug.cgi?id=15173"<br>====================================<br>
<br>
<br>
Comment #9 From Tejun Heo 2010-02-17 00:20:07 -------<br>
<br>
Thanks for testing it.<br>
<br>
The failures you're seeing is between the host controller (the via chip) and<br>
the hard drive. Both the controller and the hard drive are reporting that they<br>
can't hear each other very well. Host side issues (between the controller and<br>
the components on the mainboard) usually don't manifest as ATA bus issues.<br>
<br>
I'm afraid there isn't much the driver can do with these failures. There could<br>
be some PHY level knobs in the controller but given that this is the first<br>
report of this type of issues with the controller, I'm much more inclined<br>
toward faulty add-in board (ie. signal trace lengths not matched properly,<br>
faulty connector kind of things). Can you try it on a different operating<br>
system?<br>
<br>
Thanks.<br>
---------------------------------------------------------------------------<br>
3)<br>
---------------------------------------------------------------------------<br>
###
<br>========= SCRAPER REMOVED AN EMBEDDED LINK HERE ===========<br>url was:"https://bugzilla.kernel.org/attachment.cgi?id=26589&amp;action=edit"<br>linktext was:"https://bugzilla.kernel.org/attachment. ... ction=edit"<br>====================================<br>
###<br>
<br>
drivers/ata/sata_via.c | 13 +++++++++++++<br>
1 file changed, 13 insertions(+)<br>
<br>
diff --git a/drivers/ata/sata_via.c b/drivers/ata/sata_via.c<br>
index 101d8c2..0ecd0f6 100644<br>
--- a/drivers/ata/sata_via.c<br>
+++ b/drivers/ata/sata_via.c<br>
@@ -575,6 +575,19 @@ static void svia_configure(struct pci_dev *pdev)<br>
tmp8 |= NATIVE_MODE_ALL;<br>
pci_write_config_byte(pdev, SATA_NATIVE_MODE, tmp8);<br>
}<br>
+<br>
+    /*<br>
+ * vt6421 has problems talking to some drives. The following<br>
+ * is the magic fix from Joseph Chan &lt;<a href="mailto:JosephChan@via.com.tw">JosephChan@via.com.tw</a>&gt;.<br>
+ * Please add proper documentation if possible.<br>
+ *<br>
+ * 
<br>========= SCRAPER REMOVED AN EMBEDDED LINK HERE ===========<br>url was:"https://bugzilla.kernel.org/show_bug.cgi?id=15173"<br>linktext was:"https://bugzilla.kernel.org/show_bug.cgi?id=15173"<br>====================================<br>
<br>
+ */<br>
+    if (pdev-&gt;device == 0x3249) {<br>
+ pci_read_config_byte(pdev, 0x52, &amp;tmp8);<br>
+ tmp8 |= 1 &lt;&lt; 2;<br>
+ pci_write_config_byte(pdev, 0x52, tmp8);<br>
+    }<br>
}<br>
<br>
static int svia_init_one(struct pci_dev *pdev, const struct pci_device_id *ent)<br>
---------------------------------------------------------------------------<br>
---------------------------------------------------------------------------<br>
4) Comment #20 From Jorrit Tijben 2010-06-04 06:49:05 -------<br>
<br>
Hello,<br>
<br>
Excuse me for the late response, but I can confirm the fix by Joseph Chan<br>
works. hdparm -tT now gives around 50MB/s for buffered disk reads now and the<br>
error messages are gone.<br>
<br>
The performance is still a bit meager compared to the SB700 on-board<br>
controller, but I don't know what the possible bottlenecks are.<br>
<br>
A very big thanks to all for investigating and fixing this, it's *really*<br>
appreaciated!<br>
<br>
Jorrit Tijben<br>
---------------------------------------------------------------------------<br>
5) 
<br>========= SCRAPER REMOVED AN EMBEDDED LINK HERE ===========<br>url was:"http://www.dslreports.com/forum/r20174361-satavia-module-problem-multiple-distros"<br>linktext was:"http://www.dslreports.com/forum/r201743 ... le-distros"<br>====================================<br>
<br>
<br>
evilghost<br>
Premium<br>
join:2003-11-22<br>
Springville, AL<br>
<br>
all_generic_ide at boot? CONFIG_BLK_DEV_IDEDISK disabled in the kernel also appears to work.<br>
---------------------------------------------------------------------------<br>
6) Search on"sata_via fix" =&gt;<br>
<br>

<br>========= SCRAPER REMOVED AN EMBEDDED LINK HERE ===========<br>url was:"http://www.mail-archive.com/linux-ide@vger.kernel.org/msg03945.html"<br>linktext was:"http://www.mail-archive.com/linux-ide@v ... 03945.html"<br>====================================<br>
<br>
<br>

<br>========= SCRAPER REMOVED AN EMBEDDED LINK HERE ===========<br>url was:"http://www.spinics.net/lists/stable-commits/msg07178.html"<br>linktext was:"http://www.spinics.net/lists/stable-com ... 07178.html"<br>====================================<br>
<br>

<br>========= SCRAPER REMOVED AN EMBEDDED LINK HERE ===========<br>url was:"http://www.spinics.net/lists/linux-ide/msg04388.html"<br>linktext was:"http://www.spinics.net/lists/linux-ide/msg04388.html"<br>====================================<br>
<br>
<br>

<br>========= SCRAPER REMOVED AN EMBEDDED LINK HERE ===========<br>url was:"http://software.itags.org/linux-unix/132015/"<br>linktext was:"http://software.itags.org/linux-unix/132015/"<br>====================================<br>
<br>
<br>

<br>========= SCRAPER REMOVED AN EMBEDDED LINK HERE ===========<br>url was:"http://old.nabble.com/-patch-0-2--sata_via:-bugfixes-for-vt6420-and-vt6421-td2719 4988.html"<br>linktext was:"http://old.nabble.com/-patch-0-2--sata_ ... 94988.html"<br>====================================<br>
 <br>
===========================================================================<br>
7)<br>
The following code was gleaned,too. However, I do not know what to do with it<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>###http://www.linuxhq.com/kernel/v2.4/30/drivers/scsi/sata_via.c

diff -urN linux-2.4.29/drivers/scsi/sata_via.c linux-2.4.30/drivers/scsi/sata_via.c
--- linux-2.4.29/drivers/scsi/sata_via.c   2005-01-19 06:10:03.000000000 -0800
+++ linux-2.4.30/drivers/scsi/sata_via.c   2005-04-03 18:42:19.960155532 -0700
@@ -24,6 +24,11 @@
    If you do not delete the provisions above, a recipient may use your
    version of this file under either the OSL or the GPL.
 
+   ----------------------------------------------------------------------
+
+   To-do list:
+   * VT6421 PATA support
+
  */
 
 #include &lt;linux/kernel.h&gt;
@@ -38,11 +43,14 @@
 #include &lt;asm/io.h&gt;
 
 #define DRV_NAME  "sata_via"
-#define DRV_VERSION  "1.0"
+#define DRV_VERSION  "1.1"
 
-enum {
-   via_sata      = 0,
+enum board_ids_enum {
+   vt6420,
+   vt6421,
+};
 
+enum {
    SATA_CHAN_ENAB      = 0x40, /* SATA channel enable */
    SATA_INT_GATE      = 0x41, /* SATA interrupt gating */
    SATA_NATIVE_MODE   = 0x42, /* Native mode enable */
@@ -50,10 +58,8 @@
 
    PORT0         = (1 &lt;&lt; 1),
    PORT1         = (1 &lt;&lt; 0),
-
-   ENAB_ALL      = PORT0 | PORT1,
-
-   INT_GATE_ALL      = PORT0 | PORT1,
+   ALL_PORTS      = PORT0 | PORT1,
+   N_PORTS         = 2,
 
    NATIVE_MODE_ALL      = (1 &lt;&lt; 7) | (1 &lt;&lt; 6) | (1 &lt;&lt; 5) | (1 &lt;&lt; 4),
 
@@ -66,7 +72,8 @@
 static void svia_scr_write (struct ata_port *ap, unsigned int sc_reg, u32 val);
 
 static struct pci_device_id svia_pci_tbl[] = {
-   { 0x1106, 0x3149, PCI_ANY_ID, PCI_ANY_ID, 0, 0, via_sata },
+   { 0x1106, 0x3149, PCI_ANY_ID, PCI_ANY_ID, 0, 0, vt6420 },
+   { 0x1106, 0x3249, PCI_ANY_ID, PCI_ANY_ID, 0, 0, vt6421 },
 
    { }   /* terminate list */
 };
@@ -111,6 +118,9 @@
 
    .bmdma_setup            = ata_bmdma_setup,
    .bmdma_start            = ata_bmdma_start,
+   .bmdma_stop      = ata_bmdma_stop,
+   .bmdma_status      = ata_bmdma_status,
+
    .qc_prep      = ata_qc_prep,
    .qc_issue      = ata_qc_issue_prot,
 
@@ -159,18 +169,132 @@
    8, 4, 8, 4, 16, 256
 };
 
+static const unsigned int vt6421_bar_sizes[] = {
+   16, 16, 16, 16, 32, 128
+};
+
 static unsigned long svia_scr_addr(unsigned long addr, unsigned int port)
 {
    return addr + (port * 128);
 }
 
+static unsigned long vt6421_scr_addr(unsigned long addr, unsigned int port)
+{
+   return addr + (port * 64);
+}
+
+static void vt6421_init_addrs(struct ata_probe_ent *probe_ent,
+               struct pci_dev *pdev,
+               unsigned int port)
+{
+   unsigned long reg_addr = pci_resource_start(pdev, port);
+   unsigned long bmdma_addr = pci_resource_start(pdev, 4) + (port * 8);
+   unsigned long scr_addr;
+
+   probe_ent-&gt;port[port].cmd_addr = reg_addr;
+   probe_ent-&gt;port[port].altstatus_addr =
+   probe_ent-&gt;port[port].ctl_addr = (reg_addr + 8) | ATA_PCI_CTL_OFS;
+   probe_ent-&gt;port[port].bmdma_addr = bmdma_addr;
+
+   scr_addr = vt6421_scr_addr(pci_resource_start(pdev, 5), port);
+   probe_ent-&gt;port[port].scr_addr = scr_addr;
+
+   ata_std_ports(&amp;probe_ent-&gt;port[port]);
+}
+
+static struct ata_probe_ent *vt6420_init_probe_ent(struct pci_dev *pdev)
+{
+   struct ata_probe_ent *probe_ent;
+   struct ata_port_info *ppi = &amp;svia_port_info;
+
+   probe_ent = ata_pci_init_native_mode(pdev, &amp;ppi);
+   if (!probe_ent)
+      return NULL;
+
+   probe_ent-&gt;port[0].scr_addr =
+      svia_scr_addr(pci_resource_start(pdev, 5), 0);
+   probe_ent-&gt;port[1].scr_addr =
+      svia_scr_addr(pci_resource_start(pdev, 5), 1);
+
+   return probe_ent;
+}
+
+static struct ata_probe_ent *vt6421_init_probe_ent(struct pci_dev *pdev)
+{
+   struct ata_probe_ent *probe_ent;
+   unsigned int i;
+
+   probe_ent = kmalloc(sizeof(*probe_ent), GFP_KERNEL);
+   if (!probe_ent)
+      return NULL;
+
+   memset(probe_ent, 0, sizeof(*probe_ent));
+   probe_ent-&gt;dev = pci_dev_to_dev(pdev);
+   INIT_LIST_HEAD(&amp;probe_ent-&gt;node);
+
+   probe_ent-&gt;sht      = &amp;svia_sht;
+   probe_ent-&gt;host_flags   = ATA_FLAG_SATA | ATA_FLAG_SATA_RESET |
+              ATA_FLAG_NO_LEGACY;
+   probe_ent-&gt;port_ops   = &amp;svia_sata_ops;
+   probe_ent-&gt;n_ports   = N_PORTS;
+   probe_ent-&gt;irq      = pdev-&gt;irq;
+   probe_ent-&gt;irq_flags   = SA_SHIRQ;
+   probe_ent-&gt;pio_mask   = 0x1f;
+   probe_ent-&gt;mwdma_mask   = 0x07;
+   probe_ent-&gt;udma_mask   = 0x7f;
+
+   for (i = 0; i &lt; N_PORTS; i++)
+      vt6421_init_addrs(probe_ent, pdev, i);
+
+   return probe_ent;
+}
+
+static void svia_configure(struct pci_dev *pdev)
+{
+   u8 tmp8;
+
+   pci_read_config_byte(pdev, PCI_INTERRUPT_LINE, &amp;tmp8);
+   printk(KERN_INFO DRV_NAME"(%s): routed to hard irq line %d\n",
+          pci_name(pdev),
+          (int) (tmp8 &amp; 0xf0) == 0xf0 ? 0 : tmp8 &amp; 0x0f);
+
+   /* make sure SATA channels are enabled */
+   pci_read_config_byte(pdev, SATA_CHAN_ENAB, &amp;tmp8);
+   if ((tmp8 &amp; ALL_PORTS) != ALL_PORTS) {
+      printk(KERN_DEBUG DRV_NAME"(%s): enabling SATA channels (0x%x)\n",
+             pci_name(pdev), (int) tmp8);
+      tmp8 |= ALL_PORTS;
+      pci_write_config_byte(pdev, SATA_CHAN_ENAB, tmp8);
+   }
+
+   /* make sure interrupts for each channel sent to us */
+   pci_read_config_byte(pdev, SATA_INT_GATE, &amp;tmp8);
+   if ((tmp8 &amp; ALL_PORTS) != ALL_PORTS) {
+      printk(KERN_DEBUG DRV_NAME"(%s): enabling SATA channel interrupts (0x%x)\n",
+             pci_name(pdev), (int) tmp8);
+      tmp8 |= ALL_PORTS;
+      pci_write_config_byte(pdev, SATA_INT_GATE, tmp8);
+   }
+
+   /* make sure native mode is enabled */
+   pci_read_config_byte(pdev, SATA_NATIVE_MODE, &amp;tmp8);
+   if ((tmp8 &amp; NATIVE_MODE_ALL) != NATIVE_MODE_ALL) {
+      printk(KERN_DEBUG DRV_NAME"(%s): enabling SATA channel native mode (0x%x)\n",
+             pci_name(pdev), (int) tmp8);
+      tmp8 |= NATIVE_MODE_ALL;
+      pci_write_config_byte(pdev, SATA_NATIVE_MODE, tmp8);
+   }
+}
+
 static int svia_init_one (struct pci_dev *pdev, const struct pci_device_id *ent)
 {
    static int printed_version;
    unsigned int i;
    int rc;
-   struct ata_port_info *ppi;
    struct ata_probe_ent *probe_ent;
+   int board_id = (int) ent-&gt;driver_data;
+   const int *bar_sizes;
+   int pci_dev_busy = 0;
    u8 tmp8;
 
    if (!printed_version++)
@@ -181,20 +305,28 @@
       return rc;
 
    rc = pci_request_regions(pdev, DRV_NAME);
-   if (rc)
+   if (rc) {
+      pci_dev_busy = 1;
       goto err_out;
+   }
 
-   pci_read_config_byte(pdev, SATA_PATA_SHARING, &amp;tmp8);
-   if (tmp8 &amp; SATA_2DEV) {
-      printk(KERN_ERR DRV_NAME"(%s): SATA master/slave not supported (0x%x)\n",
-             pci_name(pdev), (int) tmp8);
-      rc = -EIO;
-      goto err_out_regions;
+   if (board_id == vt6420) {
+      pci_read_config_byte(pdev, SATA_PATA_SHARING, &amp;tmp8);
+      if (tmp8 &amp; SATA_2DEV) {
+         printk(KERN_ERR DRV_NAME"(%s): SATA master/slave not supported (0x%x)\n",
+                pci_name(pdev), (int) tmp8);
+         rc = -EIO;
+         goto err_out_regions;
+      }
+
+      bar_sizes = &amp;svia_bar_sizes[0];
+   } else {
+      bar_sizes = &amp;vt6421_bar_sizes[0];
    }
 
    for (i = 0; i &lt; ARRAY_SIZE(svia_bar_sizes); i++)
       if ((pci_resource_start(pdev, i) == 0) ||
-          (pci_resource_len(pdev, i) &lt; svia_bar_sizes[i])) {
+          (pci_resource_len(pdev, i) &lt; bar_sizes[i])) {
          printk(KERN_ERR DRV_NAME"(%s): invalid PCI BAR %u (sz 0x%lx, val 0x%lx)\n",
                 pci_name(pdev), i,
                 pci_resource_start(pdev, i),
@@ -207,8 +339,11 @@
    if (rc)
       goto err_out_regions;
 
-   ppi = &amp;svia_port_info;
-   probe_ent = ata_pci_init_native_mode(pdev, &amp;ppi);
+   if (board_id == vt6420)
+      probe_ent = vt6420_init_probe_ent(pdev);
+   else
+      probe_ent = vt6421_init_probe_ent(pdev);
+   
    if (!probe_ent) {
       printk(KERN_ERR DRV_NAME"(%s): out of memory\n",
              pci_name(pdev));
@@ -216,42 +351,7 @@
       goto err_out_regions;
    }
 
-   probe_ent-&gt;port[0].scr_addr =
-      svia_scr_addr(pci_resource_start(pdev, 5), 0);
-   probe_ent-&gt;port[1].scr_addr =
-      svia_scr_addr(pci_resource_start(pdev, 5), 1);
-
-   pci_read_config_byte(pdev, PCI_INTERRUPT_LINE, &amp;tmp8);
-   printk(KERN_INFO DRV_NAME"(%s): routed to hard irq line %d\n",
-          pci_name(pdev),
-          (int) (tmp8 &amp; 0xf0) == 0xf0 ? 0 : tmp8 &amp; 0x0f);
-
-   /* make sure SATA channels are enabled */
-   pci_read_config_byte(pdev, SATA_CHAN_ENAB, &amp;tmp8);
-   if ((tmp8 &amp; ENAB_ALL) != ENAB_ALL) {
-      printk(KERN_DEBUG DRV_NAME"(%s): enabling SATA channels (0x%x)\n",
-             pci_name(pdev), (int) tmp8);
-      tmp8 |= ENAB_ALL;
-      pci_write_config_byte(pdev, SATA_CHAN_ENAB, tmp8);
-   }
-
-   /* make sure interrupts for each channel sent to us */
-   pci_read_config_byte(pdev, SATA_INT_GATE, &amp;tmp8);
-   if ((tmp8 &amp; INT_GATE_ALL) != INT_GATE_ALL) {
-      printk(KERN_DEBUG DRV_NAME"(%s): enabling SATA channel interrupts (0x%x)\n",
-             pci_name(pdev), (int) tmp8);
-      tmp8 |= INT_GATE_ALL;
-      pci_write_config_byte(pdev, SATA_INT_GATE, tmp8);
-   }
-
-   /* make sure native mode is enabled */
-   pci_read_config_byte(pdev, SATA_NATIVE_MODE, &amp;tmp8);
-   if ((tmp8 &amp; NATIVE_MODE_ALL) != NATIVE_MODE_ALL) {
-      printk(KERN_DEBUG DRV_NAME"(%s): enabling SATA channel native mode (0x%x)\n",
-             pci_name(pdev), (int) tmp8);
-      tmp8 |= NATIVE_MODE_ALL;
-      pci_write_config_byte(pdev, SATA_NATIVE_MODE, tmp8);
-   }
+   svia_configure(pdev);
 
    pci_set_master(pdev);
 
@@ -262,7 +362,8 @@
 err_out_regions:
    pci_release_regions(pdev);
 err_out:
-   pci_disable_device(pdev);
+   if (!pci_dev_busy)
+      pci_disable_device(pdev);
    return rc;
 }
</code></pre></div></div>
</div>
</div>

</div>
</div>
<div id="p_16827" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile16827">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 54</span></div>

</div>
</div>
<span class="username">SaminBare</span>
</dt>
<dd class="profile-joined">Joined: 30 May 2010</dd>
</dl>
<div class="postbody">
<div id="post_content16827">

<time datetime="2010-08-09T18:13">posted: 2010-08-09 &nbsp; 18:13</time>
<span class="permalink"><a href="./raid-setup-will-it-work-with-antix-on-old-p4-machi-t2595.html#p16827" title="permalink">#4</a></span>

<div class="content">FYI eriefisher and iother interested parties --<br>
<br>
From what I gather, preferred RAID drivers over the <strong><em>sata_via</em></strong> in the PCI card in question are:<br>
<br>
<em><strong>Driver</strong></em> <br>
<strong>Manufacture</strong>r    <strong>Model</strong><br>
<br>
<strong><em>sata_sil24</em></strong><br>
Sicicon Image Sil 3124, Sil 3132, Sil 3531<br>
<br>
<strong><em>ahci    </em></strong> <br>
Intel ICH6-10, ESB2, Tolopai<br>
VIA VT8251<br>
Marvel 6121, 6145<br>
SiS 966,968<br>
AMD SB600/700/800<br>
JMicron 360, 361, 363, 365, 366<br>
ULi M 5288<br>
nVidea MCP65, 67, 73, 77, 79, 7B</div>
</div>
</div>

</div>
</div>
</div>
<div class="action-bar bar-bottom">

<div class="pagination">
4 posts
&bull; Page <strong>1</strong> of <strong>1</strong>
</div>
</div>
</div>
</div>
</div>
<div class="scrollToTopText"><a href="#top">goto top of page</a></div>

</div>
</body></html>
