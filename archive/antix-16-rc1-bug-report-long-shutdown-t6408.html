<!DOCTYPE html>
<html dir="ltr" lang="en-gb">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" />
<title>AntiX-16-RC1 bug report - Long shutdown - antiX oldforums archive</title>
   
<link rel="stylesheet" href="../aaa_style.css">
<script type="text/javascript" src ="../aaa_oldforums.js"></script>
</head>
<body>
<div id="wrap" class="wrap">
<a id="top" class="top-anchor" accesskey="t"></a>

<div id="inner-wrap">
<ul id="nav-breadcrumbs" class="nav-breadcrumbs linklist navlinks clear-after" role="menubar">
<li class="scroll-breadcrumbs breadcrumbs">
<span class="crumb"><a href="./index.html" accesskey="h" data-navbar-reference="index"><span>antiX - oldforums archive</span></a> &raquo;&raquo; </span>

<span class="crumb"><a href="./orphaned-posts-f27/index.html"><span>Orphaned Posts</span></a> &raquo;&raquo; </span>

<span class="crumb"><a href="./development-old-f39/index.html"><span>Development (Old)</span></a></span>
</li>
</ul>

<div id="page-body" class="page-body" role="main">
<div class="postprofile_container postprofile_Left">
<div>
<div class="topictitleheader"><span class="statictopictitle">topic title: </span><span class="topic-titleb"><a href="./antix-16-rc1-bug-report-long-shutdown-t6408.html">AntiX-16-RC1 bug report - Long shutdown</a></div>
<div class="pagination">
13 posts
&bull; Page <strong>1</strong> of <strong>1</strong>
</div>
</div>

<div class="action-bar bar-top">
</div>
<div class="viewtopic_wrapper">
<div id="p_46998" class="post has-profile bg2">
 <div class="inner">
<dl class="postprofile" id="profile46998">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 148</span></div>

</div>
</div>
<span class="username">chrispop99</span>
</dt>
<dd class="profile-joined">Joined: 21 Apr 2011</dd>
</dl>
<div class="postbody">
<div id="post_content46998">
<time datetime="2016-06-14T11:05">posted: 2016-06-14 &nbsp; 11:05</time>
<span class="permalink"><a href="./antix-16-rc1-bug-report-long-shutdown-t6408.html#p46998" title="permalink">#1</a></span>

<div class="content">(Only reported in case it affects other users - not an issue for me.)<br>
<br>
A 32-bit install on a Thinkpad T41 takes a long time to shutdown. It waits at:<br>
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Stopping enhanced syslogd: rsyslogd</code></pre></div>
for 105 seconds.<br>
<br>
A 32-bit install on other hardware does not do this.<br>
<br>
Hardware affected:<br>
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>chris@antix6-32RC1:~
$ inxi -F
System:    Host: antix6-32RC1 Kernel: 4.4.10-antix.1-486-smp i686 (32 bit)
           Desktop: IceWM 1.3.8
           Distro: antiX-16-RC1_386-full Berta CÃ¡ceres 13 June 2016
Machine:   System: IBM (portable) product: 23748RG v: ThinkPad T41
           Mobo: IBM model: 23748RG
           Bios: IBM v: 1RETDGWW (3.12 ) date: 10/18/2004
Battery    BAT0: charge: 35.2 Wh 98.9% condition: 35.6/47.5 Wh (75%)
CPU:       Single core Intel Pentium M (-UP-) cache: 1024 KB
           speed: 1600 MHz (max)
Graphics:  Card: Advanced Micro Devices [AMD/ATI] RV200/M7 [Mobility Radeon 7500]
           Display Server: X.Org 1.16.4 drivers: ati,radeon (unloaded: fbdev,vesa)
           Resolution: 1024x768@60.00hz
           GLX Renderer: Mesa DRI R100 (RV200 4C57) x86/MMX/SSE2 DRI2
           GLX Version: 1.3 Mesa 10.3.2
Audio:     Card Intel 82801DB/DBL/DBM (ICH4/ICH4-L/ICH4-M) AC'97 Audio Controller
           driver: snd_intel8x0
           Sound: ALSA v: k4.4.10-antix.1-486-smp
Network:   Card-1: Intel 82540EP Gigabit Ethernet Controller (Mobile)
           driver: e1000
           IF: eth0 state: down mac: 00:0d:60:7a:ff:a3
           Card-2: Qualcomm Atheros AR5212 802.11abg NIC driver: ath5k
           IF: wlan0 state: up mac: 00:05:4e:46:db:02
Drives:    HDD Total Size: 31.9GB (15.1% used)
           ID-1: /dev/sda model: KingSpec_KSD size: 31.9GB
Partition: ID-1: / size: 28G used: 2.6G (10%) fs: ext4 dev: /dev/sda1
           ID-2: swap-1 size: 2.17GB used: 0.00GB (0%) fs: swap dev: /dev/sda2
Sensors:   System Temperatures: cpu: 71.0C mobo: 45.0C
           Fan Speeds (in rpm): cpu: 3560
Info:      Processes: 129 Uptime: 2:16 Memory: 139.6/1002.9MB
           Client: Shell (bash) inxi: 2.3.0 </code></pre></div>
Chris</div>
</div>
</div>

</div>
</div>
<div id="p_47017" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile47017">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 148</span></div>

</div>
</div>
<span class="username">chrispop99</span>
</dt>
<dd class="profile-joined">Joined: 21 Apr 2011</dd>
</dl>
<div class="postbody">
<div id="post_content47017">

<time datetime="2016-06-15T07:25">posted: 2016-06-15 &nbsp; 07:25</time>
<span class="permalink"><a href="./antix-16-rc1-bug-report-long-shutdown-t6408.html#p47017" title="permalink">#2</a></span>

<div class="content">Further info discovered:<br>
<br>
Perusal of /var/log/syslog shows delay seems related to network. Disabling wireless and connecting via Ethernet made shutdown behave normally.<br>
<br>
I will try to test on other hardware later this week.<br>
<br>
Chris</div>
</div>
</div>

</div>
</div>
<div id="p_47018" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile47018">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 2,238</span></div>

</div>
</div>
<span class="username">dolphin_oracle</span>
</dt>
<dd class="profile-joined">Joined: 16 Dec 2007</dd>
</dl>
<div class="postbody">
<div id="post_content47018">

<time datetime="2016-06-15T10:48">posted: 2016-06-15 &nbsp; 10:48</time>
<span class="permalink"><a href="./antix-16-rc1-bug-report-long-shutdown-t6408.html#p47018" title="permalink">#3</a></span>

<div class="content">Do you have an network shares mounted when you shutdown and expierence the long shutdown time?</div>
</div>
</div>

</div>
</div>
<div id="p_47019" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile47019">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 1,028</span></div>

</div>
</div>
<span class="username">SamK</span>
</dt>
<dd class="profile-joined">Joined: 21 Aug 2011</dd>
</dl>
<div class="postbody">
<div id="post_content47019">

<time datetime="2016-06-15T11:04">posted: 2016-06-15 &nbsp; 11:04</time>
<span class="permalink"><a href="./antix-16-rc1-bug-report-long-shutdown-t6408.html#p47019" title="permalink">#4</a></span>

<div class="content"><blockquote><div><cite>dolphin_oracle wrote:</cite>Do you have an network shares mounted when you shutdown and expierence the long shutdown time?</div></blockquote>You beat me to asking the same question.</div>
</div>
</div>

</div>
</div>
<div id="p_47022" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile47022">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 148</span></div>

</div>
</div>
<span class="username">chrispop99</span>
</dt>
<dd class="profile-joined">Joined: 21 Apr 2011</dd>
</dl>
<div class="postbody">
<div id="post_content47022">

<time datetime="2016-06-15T14:34">posted: 2016-06-15 &nbsp; 14:34</time>
<span class="permalink"><a href="./antix-16-rc1-bug-report-long-shutdown-t6408.html#p47022" title="permalink">#5</a></span>

<div class="content"><blockquote><div><cite>dolphin_oracle wrote:</cite>Do you have an network shares mounted when you shutdown and expierence the long shutdown time?</div></blockquote>
Yes; I will test with the share disconnected, and report.<br>
<br>
Chris</div>

</div>
</div>

</div>
</div>
<div id="p_47023" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile47023">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 148</span></div>

</div>
</div>
<span class="username">chrispop99</span>
</dt>
<dd class="profile-joined">Joined: 21 Apr 2011</dd>
</dl>
<div class="postbody">
<div id="post_content47023">

<time datetime="2016-06-15T15:44">posted: 2016-06-15 &nbsp; 15:44</time>
<span class="permalink"><a href="./antix-16-rc1-bug-report-long-shutdown-t6408.html#p47023" title="permalink">#6</a></span>

<div class="content">The circumstances needed to recreate the extended shut-down are mounted network shares, and a wireless connection.<br>
<br>
If connected by Ethernet, shut-down is normal even with a connected share.<br>
<br>
I will test on other hardware tomorrow; if others are affected, perhaps Disconnectshares should run automatically on shut-down?<br>
<br>
Chris</div>
</div>
</div>

</div>
</div>
<div id="p_47026" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile47026">
<dt class="has-profile-rank has-avatar avatar-username">
<span class="username">anticapitalista</span>
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 5,955</span></div>

</div>
</div>
</dt>
<dd class="profile-rank">Site Admin</dd>
<dd class="profile-joined">Joined: 11 Sep 2007</dd>
</dl>
<div class="postbody">
<div id="post_content47026">

<time datetime="2016-06-15T18:29">posted: 2016-06-15 &nbsp; 18:29</time>
<span class="permalink"><a href="./antix-16-rc1-bug-report-long-shutdown-t6408.html#p47026" title="permalink">#7</a></span>

<div class="content">Since I do not use network sharing, I might be wrong here, but I would have thought that user would manually disconnect shares before shutting down or rebooting?</div>
</div>
</div>

</div>
</div>
<div id="p_47029" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile47029">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 2,238</span></div>

</div>
</div>
<span class="username">dolphin_oracle</span>
</dt>
<dd class="profile-joined">Joined: 16 Dec 2007</dd>
</dl>
<div class="postbody">
<div id="post_content47029">

<time datetime="2016-06-15T20:03">posted: 2016-06-15 &nbsp; 20:03</time>
<span class="permalink"><a href="./antix-16-rc1-bug-report-long-shutdown-t6408.html#p47029" title="permalink">#8</a></span>

<div class="content"><blockquote><div><cite>anticapitalista wrote:</cite>Since I do not use network sharing, I might be wrong here, but I would have thought that user would manually disconnect shares before shutting down or rebooting?</div></blockquote>
often that is not the case. you just shutdown. they are easy to forget after all.<br>
<br>
we fixed this in antiX 13 and 15. sam reminded me. I'm looking for the fix as we speak.</div>
</div>
</div>

</div>
</div>
<div id="p_47030" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile47030">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 2,238</span></div>

</div>
</div>
<span class="username">dolphin_oracle</span>
</dt>
<dd class="profile-joined">Joined: 16 Dec 2007</dd>
</dl>
<div class="postbody">
<div id="post_content47030">

<time datetime="2016-06-15T20:19">posted: 2016-06-15 &nbsp; 20:19</time>
<span class="permalink"><a href="./antix-16-rc1-bug-report-long-shutdown-t6408.html#p47030" title="permalink">#9</a></span>

<div class="content">I sent the fix to anti, and test here OK. chris if you wouldn't mind testing.<br>
<br>
extract the attached and place in / etc/init.d<br>
<br>
run<br>
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>sudo update-rc.d umountnfs-alternative.sh defaults</code></pre></div>
you might have to reboot for changes to go into effect. I'm not sure about that.<br>
<br>
thanks to samk for reminding me of this.</div>
<div class="notice">
Last edited by <b>dolphin_oracle</b> on 15 Jun 2016, 20:36, edited 1 time in total.
</div>
</div>
</div>

</div>
</div>
<div id="p_47031" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile47031">
<dt class="has-profile-rank has-avatar avatar-username">
<span class="username">anticapitalista</span>
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 5,955</span></div>

</div>
</div>
</dt>
<dd class="profile-rank">Site Admin</dd>
<dd class="profile-joined">Joined: 11 Sep 2007</dd>
</dl>
<div class="postbody">
<div id="post_content47031">

<time datetime="2016-06-15T20:23">posted: 2016-06-15 &nbsp; 20:23</time>
<span class="permalink"><a href="./antix-16-rc1-bug-report-long-shutdown-t6408.html#p47031" title="permalink">#10</a></span>

<div class="content">I never got that fix, or I don't remember getting it.<br>
Will include in upgraded deb</div>
</div>
</div>

</div>
</div>
<div id="p_47032" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile47032">
<dt class="has-profile-rank has-avatar avatar-username">
<span class="username">anticapitalista</span>
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 5,955</span></div>

</div>
</div>
</dt>
<dd class="profile-rank">Site Admin</dd>
<dd class="profile-joined">Joined: 11 Sep 2007</dd>
</dl>
<div class="postbody">
<div id="post_content47032">

<time datetime="2016-06-15T21:06">posted: 2016-06-15 &nbsp; 21:06</time>
<span class="permalink"><a href="./antix-16-rc1-bug-report-long-shutdown-t6408.html#p47032" title="permalink">#11</a></span>

<div class="content">New connectshares deb soon to appear in repo to (hopefully) fix this problem</div>
</div>
</div>

</div>
</div>
<div id="p_47036" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile47036">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 148</span></div>

</div>
</div>
<span class="username">chrispop99</span>
</dt>
<dd class="profile-joined">Joined: 21 Apr 2011</dd>
</dl>
<div class="postbody">
<div id="post_content47036">

<time datetime="2016-06-16T06:28">posted: 2016-06-16 &nbsp; 06:28</time>
<span class="permalink"><a href="./antix-16-rc1-bug-report-long-shutdown-t6408.html#p47036" title="permalink">#12</a></span>

<div class="content"><blockquote><div><cite>dolphin_oracle wrote:</cite>I sent the fix to anti, and test here OK. chris if you wouldn't mind testing.</div></blockquote>
Tested and working fine now; thanks.<br>
<br>
Chris</div>
</div>
</div>

</div>
</div>
<div id="p_47043" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile47043">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 1,028</span></div>

</div>
</div>
<span class="username">SamK</span>
</dt>
<dd class="profile-joined">Joined: 21 Aug 2011</dd>

</dl>
<div class="postbody">
<div id="post_content47043">

<time datetime="2016-06-16T08:14">posted: 2016-06-16 &nbsp; 08:14</time>
<span class="permalink"><a href="./antix-16-rc1-bug-report-long-shutdown-t6408.html#p47043" title="permalink">#13</a></span>

<div class="content"><blockquote><div><cite>chrispop99 wrote:</cite>The circumstances needed to recreate the extended shut-down are mounted network shares, and a wireless connection.<br>
[...]<br>
Tested and working fine now; thanks.</div></blockquote><blockquote><div><cite>dolphin_oracle wrote:</cite>we fixed this in antiX 13 and 15. sam reminded me. I'm looking for the fix as we speak.</div></blockquote>Thanks for picking up the ball on this.<br>
<br>
<br>
BACKGROUND<br>
Referring back to February 2014; at that time a web search revealed large numbers of Debian users were reporting the problem of a pause during shut-down. A fix was not introduced by Debian and is unlikely to be following the move to systemD. antiX inherited the unwanted behaviour because of its Debian parentage, and it remains in place because of our retention of sysvinit.<br>
<br>
Connectshares cannot avoid a problem of that nature and is not causing it. Shares mounted via standard Linux mount techniques (i.e. not using helpers such as Connectshares) also exhibit the pause symptoms at shut-down if they are not unmounted before beforehand. The unwanted behaviour originates from upstream Debian.<br>
<br>
The problem stems from the sequence in which the Debian init.d system stops services. The short version is, wireless networking is stopped before shares are unmounted. In turn this generates the time-out delay later in reboot/shut-down process. <br>
<br>
The standard Debian file at the heart of the problem is / etc/init.d/umountnfs.sh. Its purpose is shown in the following abstract from the file.
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Abstract starts
# Short-Description: Unmount all network filesystems except the root fs.
# Description:       Also unmounts all virtual filesystems (proc,
#                    devpts, usbfs, sysfs) that are not mounted at the
#                    top level.
Abstract ends</code></pre></div>
The previously submitted fix is named unmountnfs-alternative.sh. It is identical to unmountnfs.sh except for one minor amendment. Towards the head of the file,"Provides" now indicates"umountnfs-alternative". The fix runs its links earlier in the init.d sequence which prevents the pause condition and allows the reboot/shut-down to continue without a delay.<br>
<br>
The result is neutral for systems that do not have the initial problem, beneficial for those that do, and transparent for all.<br>
<br>
<br>
SUGGESTION
<blockquote><div><cite>anticapitalista wrote:</cite>New connectshares deb soon to appear in repo to (hopefully) fix this problem</div></blockquote>Probably it is best to implement the fix outside of Connectshares. Because this problem is not caused by Connectshares, it will be of most benefit when the fix is not tied to it. In that way the fix will be available to systems which use share mounting techniques other than Connectshares. Perhaps incorporating it into the basic antiX build might be a better approach.</div>
</div>
</div>

</div>
</div>
</div>
<div class="action-bar bar-bottom">

<div class="pagination">
13 posts
&bull; Page <strong>1</strong> of <strong>1</strong>
</div>
</div>
</div>
</div>
</div>
<div class="scrollToTopText"><a href="#top">goto top of page</a></div>

</div>
</body></html>
