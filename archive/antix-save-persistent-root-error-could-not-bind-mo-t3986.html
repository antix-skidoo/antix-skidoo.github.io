<!DOCTYPE html>
<html dir="ltr" lang="en-gb">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" />
<title>antiX save persistent root error &quot;could not bind mount...&quot; - antiX oldforums archive</title>
   
<link rel="stylesheet" href="../aaa_style.css">
<script type="text/javascript" src ="../aaa_oldforums.js"></script>
</head>
<body>
<div id="wrap" class="wrap">
<a id="top" class="top-anchor" accesskey="t"></a>

<div id="inner-wrap">
<ul id="nav-breadcrumbs" class="nav-breadcrumbs linklist navlinks clear-after" role="menubar">
<li class="scroll-breadcrumbs breadcrumbs">
<span class="crumb"><a href="./index.html" accesskey="h" data-navbar-reference="index"><span>antiX - oldforums archive</span></a> &raquo;&raquo; </span>

<span class="crumb"><a href="./orphaned-posts-f27/index.html"><span>Orphaned Posts</span></a> &raquo;&raquo; </span>

<span class="crumb"><a href="./releases-old-f44/index.html"><span>Releases (Old)</span></a> &raquo;&raquo; </span>

<span class="crumb"><a href="./antix-12-edelweispiraten-f47/index.html"><span>antiX-12 Edelwei√üpiraten</span></a></span>
</li>
</ul>

<div id="page-body" class="page-body" role="main">
<div class="postprofile_container postprofile_Left">
<div>
<div class="topictitleheader"><span class="statictopictitle">topic title: </span><span class="topic-titleb"><a href="./antix-save-persistent-root-error-could-not-bind-mo-t3986.html">antiX save persistent root error &quot;could not bind mount...&quot;</a></div>
<div class="pagination">
6 posts
&bull; Page <strong>1</strong> of <strong>1</strong>
</div>
</div>

<div class="action-bar bar-top">
</div>
<div class="viewtopic_wrapper">
<div id="p_26670" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile26670">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 1,444</span></div>

</div>
</div>
<span class="username">skidoo</span>
</dt>
<dd class="profile-joined">Joined: 09 Feb 2012</dd>
</dl>
<div class="postbody">
<div id="post_content26670">
<time datetime="2012-11-01T07:52">posted: 2012-11-01 &nbsp; 07:52</time>
<span class="permalink"><a href="./antix-save-persistent-root-error-could-not-bind-mo-t3986.html#p26670" title="permalink">#1</a></span>

<div class="content">"could not bind mount /live/boot-dev /media/sdb1 to /live/boot-dev"<br>
<br>
so I followed up by trying"fix or delete"<br>
and met this error message:<br>
"strange. No more files left to fix or delete"<br>
<br>
My preferences are set to semi-auto, and this was a manual (on demand, not at shutdown) run.<br>
Upon retrying, beneath the lines stating"broken" I noted the detail claiming<br>
"rootfs is already larger than available ram"<br>
(or words to that effect).<br>
<br>
It had been a relatively short session &amp; I hadn't really made any remarkable changes, space-wise, during the session.<br>
From memory, I had only installed: an updated version of spaceFM, as well as 2 iceweasel extensions.<br>
Also, from memory (verified after the fact)"rootfs used space" and"required space" was @230Mb<br>
-=-<br>
System has 2Gb ram.<br>
Live partition is 4Gb.<br>
Space reserved for rootfs is @2Gb.<br>
a 4Gb swap partition is mounted<br>
When the error occurred, conky displayed 90Mb ram used / 0 swap<br>
<br>
I'm in the habit of running bleachbit (as demo, and again as root) prior to performing a"save root persistence" operation<br>
and doing so hasn't previously interfered with saving.<br>
<br>
At the shutdown prompt, the save operation similarly failed.<br>
<br>
=====================<br>
<br>
Upon restart, I chose the (Root Persistence) grub entry<br>
~~ the one with parentheses, as usual<br>
(b/c I have no idea what/when the heck the seemingly redundant grub entry is to be used)<br>
and all was well, as of the prior session.<br>
<br>
Entering the"control center} Live } save root persistence" dialog, I read:<br>
reported rootfs space: 2002meg<br>
total rootfs space: 1801meg<br>
used: 255 meg<br>
excluded file size: 1meg<br>
persist device total: 4126 meg<br>
persist device free: 1733 meg<br>
<br>
Successful save.<br>
Followed by several successful restarts and repeated on-demand, as well as shutdown, persistence saves.<br>
<br>
<br>
During some runs, I noticed"excluded file size" is sometimes 1meg, other times is 50meg+<br>
(and I don't understand why)<br>
<br>
Above, those reported / used / required / free values I provided were from a note I carefully jotted at the time.<br>
Compounding my confusion is the fact that now (right now)<br>
although (basically) nothing has changed, content-wise, on the system...<br>
...the reported values are<br>
219 used<br>
215 required (I'm under the impression the script guesstimates this, in advance)<br>
then, immediately afterward, following successful save<br>
total: 2002<br>
used: 246<br>
free:1654<br>
<br>
^--- on subsequent runs, the previously squashed dataset gets packed even smaller when it is re-squashed???</div>
<div class="notice">
Last edited by <b>skidoo</b> on 04 Nov 2012, 05:30, edited 2 times in total.
</div>
</div>
</div>

</div>
</div>
<div id="p_26677" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile26677">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 1,308</span></div>

</div>
</div>
<span class="username">BitJam</span>
</dt>
<dd class="profile-joined">Joined: 31 Aug 2009</dd>
</dl>
<div class="postbody">
<div id="post_content26677">

<time datetime="2012-11-01T22:29">posted: 2012-11-01 &nbsp; 22:29</time>
<span class="permalink"><a href="./antix-save-persistent-root-error-could-not-bind-mo-t3986.html#p26677" title="permalink">#2</a></span>

<div class="content">I'm sorry you are having difficulties.
<blockquote class="uncited"><div>"could not bind mount /live/boot-dev /media/sdb1 to /live/boot-dev"</div></blockquote>Had you previously mounted /dev/sdb1 at /media/sdb1? That might have caused this problem.<br>
<br>
It looks like /dev/sdb1 is your boot device. It is normally mounted at /dev/boot-dev on a LiveCD/USB system. If you add the"toram" boot option and the copy to ram is successful then it gets unmounted at boot time. That is why the persist-save program will sometimes try to mount the boot device back at /live/boot-dev. The two possibilities I had considered were if the boot device was unmounted or if the boot device was mounted elsewhere. I had not considered the third possibility of the boot device being already bind mounted elsewhere.<br>
<br>
My guess is that /dev/sdb1 was already mounted at /live/boot-dev and then you mounted it at /media/sdb1 as well (via a bind mount, perhaps unknown to you). So far so good. When persist-save ran, it saw that /dev/sdb1 was mounted at /media/sdb1 and it tried to bind mount it to /live/boot-dev. This bind mount failed because it thought the old mount point was both /live/boot-dev and /media/sdb1. I will try to fix the code to deal with this situation. It is possible the mounting difficulties are what caused your other problems. <br>
<br>
It might be useful if you would post a copy of the log file the next time something like this happens. It should be at /var/log/antiX/persist-save.log. I strip the color codes out by running"cat /var/log/antiX/persist-save.log" in a terminal and then do a copy and paste from the terminal window. You can also run persist-save directly in a terminal window. Use the -v option to get the log information printed directly to the screen. I believe the -n (--nocolor) option should also get rid of the color codes. Please don't post the content of files with color codes directly.<br>
<br>
It is difficult for me to try to track down exactly what was going on without the verbatim messages. I'm hoping that by fixing the mount problem, the other errors will go away. <br>
<blockquote class="uncited"><div>During some runs, I noticed"excluded file size" is sometimes 1meg, other times is 50meg+<br>
(and I don't understand why)</div></blockquote>These are the directories excluded when we do a persist-save:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>/lost+found
/run/acpid.socket
/run/dbus/system_bus_socket
/tmp
/var/cache/apt/*.bin
/var/cache/apt/archives/*.deb
/var/cache/debconf/*-old
/var/lib/apt/lists/*
/var/lib/dpkg/*-old</code></pre></div>
The list is from the top of the /usr/local/lib/antiX/antiX-common.sh file although this fact is not advertised. I suggested doing a"du -sch" on that list of directories to find out where the 50 meg is.
<blockquote class="uncited"><div>Compounding my confusion is the fact that now (right now)<br>
although (basically) nothing has changed, content-wise, on the system...</div></blockquote>Sorry, it is hard for me to exactly follow what you are saying here. No squashing happens during a persist-save. That only happens during remaster-me. With persist-save we are mirroring the contents of filesystems using the"rsync" command. The"guestimate" of what will be needed is taken from a"du" of the source filesystem minus a"du" of all the excluded directories on the source filesystem. Here is the actual code:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>excludes="$(basic_excludes $AUFS_RAM_MP)"
exclude_size="$(du_size $excludes)"

pdev_total=$(all_space  $PERSIST_MP)
pdev_avail=$(free_space $PERSIST_MP)

rootfs_file_size=$(du_size $(readlink -f $PERSIST_FILE))

aufsrw_used=$(du_size $AUFS_RAM_MP)
rootfs_used=$(du_size $ROOTFS_MP)

rootfs_full=$(all_space $ROOTFS_MP)

# Reduce available size by 10% for a safety margin and because
# the du and df commands give different sizes.
safe_full=$(( $rootfs_full * 90 / 100 ))
need_size=$(( $aufsrw_used - $exclude_size ))
xfer_size=$(( $need_size - $rootfs_used))
["$xfer_size" -lt"10" ] &amp;&amp; xfer_size="?"

main_text=(
   "$(fmt_size"reported rootfs space"  $rootfs_full)"
   "$(fmt_size"total rootfs space"     $safe_full)"
   "$(fmt_size"used rootfs space"      $rootfs_used)"
   "$(fmt_size"excluded file size"     $exclude_size)"
   "$(fmt_size"required rootfs space"  $need_size)"
   "$(fmt_size"approx. transfer size"  $xfer_size)"</code></pre></div>Maybe you have some suggestions for making this more clear to the users. <br>
<br>
One difficulty is the difference between the"du" and"df" commands. The"du" command is like counting up the volumes of a bunch of books while the"df" is the volume of a library room just big enough to hold those books. These numbers will always be at least a little different. We have to guess the volume of the library room needed given the volume of all the books we want to put in it.</div>
</div>
</div>

</div>
</div>
<div id="p_26709" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile26709">
<dt class="no-profile-rank has-avatar avatar-username">
<dd class="detail-title-numposts">Posts: 1,444</dd>
<span class="username">skidoo</span>
</dt>
<dd class="profile-joined">Joined: 09 Feb 2012</dd>
</dl>
<div class="postbody">
<div id="post_content26709">

<time datetime="2012-11-04T05:54">posted: 2012-11-04 &nbsp; 05:54</time>
<span class="permalink"><a href="./antix-save-persistent-root-error-could-not-bind-mo-t3986.html#p26709" title="permalink">#3</a></span>

<div class="content"><blockquote class="uncited"><div>Had you previously mounted /dev/sdb1 at /media/sdb1?</div></blockquote>
Thanks. You nailed it!<br>
<br>
I'm relatively certain now what (must have) transpired:<br>
<br>
While using rox-filer as root, browsed to media path (intending to retrieve config files stored on another hotplugged pendrive)<br>
and, after mis-clicking on sdb1, clicked sdb2 and grabbed the files and...<br>
...sometime later, I wound up closing that instance of rox-filer.<br>
<br>
^---- didn't occur to me to check/unmount, as rox-filer usually raises a reminder prompt.<br>
Ouch -- for root user, it does not prompt.<br>
<blockquote class="uncited"><div>I will try to fix the code to deal with this situation</div></blockquote>
It's probably a fringe case. User will seldom be using rox-filer as root, eh.<br>
AND I've since changed the config to disable the single-click behavior in rox-filer.</div>
</div>
</div>

</div>
</div>
<div id="p_26710" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile26710">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 1,308</span></div>

</div>
</div>
<span class="username">BitJam</span>
</dt>
<dd class="profile-joined">Joined: 31 Aug 2009</dd>
</dl>
<div class="postbody">
<div id="post_content26710">

<time datetime="2012-11-04T06:33">posted: 2012-11-04 &nbsp; 06:33</time>
<span class="permalink"><a href="./antix-save-persistent-root-error-could-not-bind-mo-t3986.html#p26710" title="permalink">#4</a></span>

<div class="content">Skidoo, I think I have the bug in my code fixed. Would you be willing to test out the fix for me? I can post a fixed library here or if you send me a PM I can email it to you.<br>
<br>
Also, it is funny, part of the problem was in an old buildfstab program that was making /media directories for mounted filesystems when the system boots when the only mounted filesystem is the boot device which we don't want mounted in /media. About a week ago, I had made a new version that doesn't do that. It is so strange because a week ago I was concerned about possible problems when the boot device gets mounted in /media and here this week the bug appears. It is almost as if just thinking about a bug made it appear.<br>
<br>
I agree with you that it is confusing when I say"total rootfs space" and then print a number that is only 90% of the total space. I want to fix this too.</div>
</div>
</div>

</div>
</div>
<div id="p_26730" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile26730">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 1,444</span></div>

</div>
</div>
<section class="desktop-hide">
 <a href="#" class="username">skidoo</a> </section>
</dt>
<dd class="profile-joined">Joined: 09 Feb 2012</dd>
</dl>
<div class="postbody">
<div id="post_content26730">

<time datetime="2012-11-06T00:16">posted: 2012-11-06 &nbsp; 00:16</time>
<span class="permalink"><a href="./antix-save-persistent-root-error-could-not-bind-mo-t3986.html#p26730" title="permalink">#5</a></span>

<div class="content">Thanks for the fix. Sure I'll test it. I'll PM my email address.<br>
<blockquote class="uncited"><div>"total rootfs space" and then print a number that is only 90% of the total space</div></blockquote>I haven't yet peeked under the hood and into all the corners (to investigate the underlying scripts). From the documentation I've waded thorugh so far, I had formed the mis-impression that squashfs was involved in the process (writing persistence data)... and (so) the value displayed for total space required was an _estimate_.</div>
</div>
</div>

</div>
</div>
<div id="p_26731" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile26731">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 1,308</span></div>

</div>
</div>
<span class="username">BitJam</span>
</dt>
<dd class="profile-joined">Joined: 31 Aug 2009</dd>
</dl>
<div class="postbody">
<div id="post_content26731">

<time datetime="2012-11-06T04:54">posted: 2012-11-06 &nbsp; 04:54</time>
<span class="permalink"><a href="./antix-save-persistent-root-error-could-not-bind-mo-t3986.html#p26731" title="permalink">#6</a></span>

<div class="content">The best documentation is at: /usr/share/antiX/live-boot/index.html<br>
<br>
It does talk about remastering as a form of persistence but to some extent the only reason we provide a root persistence option is because compressing the entire filesystem is resource expensive. I'm always interested in suggestions on making this documentation more clear. As Larry Wall once noted, it is possible for there to be both too much and too little documentation.<br>
<br>
In regard to reporting sizes, I've trimmed the relevant code down further to:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>rootfs_full=$(all_space $ROOTFS_MP)

# Reduce available size by 10% for a safety margin and because
# the du and df commands give different sizes.
safe_full=$(( $rootfs_full * 90 / 100 ))    

   "$(fmt_size"reported rootfs space"  $rootfs_full)"
   "$(fmt_size"total rootfs space"     $safe_full)"</code></pre></div>
So within rounding what I call"total rootfs space" is always going to be about 90% of"reported rootfs space". I can see why this would be confusing. A 10% safety margin is probably a bit too conservative here but it makes sense to me to be a bit conservative and ask for a larger fs once the current one is 90%+ full. This is better than risk having things break because by never overfilling the rootfs file we ensure the user can go back to a stable state. <br>
<br>
Perhaps I should relabel them:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>    total rootfs space
    90% of total rootfs space
</code></pre></div>
but people might then ask why we are not making use of 100% of the available space. <br>
<br>
I got your PM and will send you a library to try soon.</div>
</div>
</div>

</div>
</div>
</div>
<div class="action-bar bar-bottom">

<div class="pagination">
6 posts
&bull; Page <strong>1</strong> of <strong>1</strong>
</div>
</div>
</div>
</div>
</div>
<div class="scrollToTopText"><a href="#top">goto top of page</a></div>

</div>
</body></html>
