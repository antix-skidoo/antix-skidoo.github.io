<!DOCTYPE html>
<html dir="ltr" lang="en-gb">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" />
<title>batti-gtk (SOLVED) - Page 2 - antiX oldforums archive</title>
   
<link rel="stylesheet" href="../aaa_style.css">
<script type="text/javascript" src ="../aaa_oldforums.js"></script>
</head>
<body>
<div id="wrap" class="wrap">
<a id="top" class="top-anchor" accesskey="t"></a>

<div id="inner-wrap">
<ul id="nav-breadcrumbs" class="nav-breadcrumbs linklist navlinks clear-after" role="menubar">
<li class="scroll-breadcrumbs breadcrumbs">
<span class="crumb"><a href="./index.html" accesskey="h" data-navbar-reference="index"><span>antiX - oldforums archive</span></a> &raquo;&raquo; </span>

<span class="crumb"><a href="./orphaned-posts-f27/index.html"><span>Orphaned Posts</span></a> &raquo;&raquo; </span>

<span class="crumb"><a href="./releases-old-f44/index.html"><span>Releases (Old)</span></a> &raquo;&raquo; </span>

<span class="crumb"><a href="./antix-13-luddite-f49/index.html"><span>antiX-13 Luddite</span></a></span>
</li>
</ul>

<div id="page-body" class="page-body" role="main">
<div class="postprofile_container postprofile_Left">
<div>
<div class="topictitleheader"><span class="statictopictitle">topic title: </span><span class="topic-titleb"><a href="./batti-gtk-solved-t4662-s15.html">batti-gtk (SOLVED)</a></div>
<div class="pagination">
28 posts
<ul>
<li class="arrow previous"><span class="jumptopagez">jump to page: </span><a class="button button-icon-only" href="./batti-gtk-solved-t4662.html" rel="prev" role="button"><span class="sr-only">Previous</span></a></li>
<li><a class="button" href="./batti-gtk-solved-t4662.html" role="button">1</a></li>
<li class="active"><span>2</span></li>
</ul>
</div>
</div>

<div class="action-bar bar-top">
</div>
<div class="viewtopic_wrapper">
<div id="p_48468" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile48468">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 604</span></div>

</div>
</div>
<span class="username">thriftee</span>
</dt>
<dd class="profile-joined">Joined: 27 Feb 2009</dd>
</dl>
<div class="postbody">
<div id="post_content48468">
<time datetime="2016-10-02T08:41">posted: 2016-10-02 &nbsp; 08:41</time>
<span class="permalink"><a href="./batti-gtk-solved-t4662-s15.html#p48468" title="permalink">#16</a></span>

<div class="content">Yes, I modified my conky a couple years ago to show the battery and go yellow, then orange, then red, and blink, but the problem is that if windows are covering it, I don't see it. I also wish it could do an audio alert when its getting really low. <br>
<br>
Anyway, thanks for helping...</div>
</div>
</div>

</div>
</div>
<div id="p_48473" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile48473">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
 <div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 1,062</span></div>

</div>
</div>
<span class="username">Dave</span>
</dt>
<dd class="profile-joined">Joined: 20 Jan 2010</dd>
</dl>
<div class="postbody">
<div id="post_content48473">

<time datetime="2016-10-02T15:39">posted: 2016-10-02 &nbsp; 15:39</time>
<span class="permalink"><a href="./batti-gtk-solved-t4662-s15.html#p48473" title="permalink">#17</a></span>

<div class="content">In your if statement for when it goes red put 'execi 60 play /path/to/audio/file' and it should play the audio file every 60 seconds as long as the battery level is low enough to be in the red. <br>
<br>
I did this as well a while ago but with a popup window prompting me to save and shutdown or plug in the laptop.</div>
</div>
</div>

</div>
</div>
<div id="p_48623" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile48623">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 604</span></div>

</div>
</div>
<span class="username">thriftee</span>
</dt>
<dd class="profile-joined">Joined: 27 Feb 2009</dd>
</dl>
<div class="postbody">
<div id="post_content48623">

<time datetime="2016-10-11T05:36">posted: 2016-10-11 &nbsp; 05:36</time>
<span class="permalink"><a href="./batti-gtk-solved-t4662-s15.html#p48623" title="permalink">#18</a></span>

<div class="content">Well, I spent a week or two a few hours here and there with 4 books and a few hours of tutorials, thinking it would be pretty simple, and trying to learn enough python to be able to improve the app a bit and package it, but the code isn't followed easily at all, and I can't understand how to figure out what is coming from where or how it works, and couldn't find any examples of something super simple to understand how to run something in the tray (did I say that right) or where the info about the battery status is coming from, or why they didn't just look at the text on it the system puts in a file someplace (was it in /proc?, I forget at the moment, but could find it if I needed to), which was what I had expected it would be doing..<br>
<br>
Anyway, thanks for posting and getting it working originally, Roky, and thanks for the good suggestions skidoo, but I guess its beyond my coding skills in the linux or python world to work on something I'd expect to be simple that becomes this complex..<br>
<br>
So that brings me back to Dave's KISS solution, and I suppose if I could get it to play a sound file and popup a warning message window that would be just as good. So Dave, how did you get the message window to popup?</div>
</div>
</div>

</div>
</div>
<div id="p_48626" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile48626">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 765</span></div>

</div>
</div>
<span class="username">rust collector</span>
</dt>
<dd class="profile-joined">Joined: 27 Dec 2011</dd>
</dl>
<div class="postbody">
<div id="post_content48626">

<time datetime="2016-10-11T17:23">posted: 2016-10-11 &nbsp; 17:23</time>
<span class="permalink"><a href="./batti-gtk-solved-t4662-s15.html#p48626" title="permalink">#19</a></span>

<div class="content">here are some notification thingie information<br>

<br>========= SCRAPER REMOVED AN EMBEDDED LINK HERE ===========<br>url was:"https://wiki.archlinux.org/index.php/Desktop_notifications"<br>linktext was:"https://wiki.archlinux.org/index.php/De ... ifications"<br>====================================<br>
<br>
<br>
I guess using notify-send, from libnotify would be ok. I am not sure if it is installed by default of not, but iIrc, the package is libnotify-bin</div>
</div>
</div>

</div>
</div>
<div id="p_48627" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile48627">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 1,062</span></div>

</div>
</div>
<span class="username">Dave</span>
</dt>
<dd class="profile-joined">Joined: 20 Jan 2010</dd>
</dl>
<div class="postbody">
<div id="post_content48627">

<time datetime="2016-10-11T17:27">posted: 2016-10-11 &nbsp; 17:27</time>
<span class="permalink"><a href="./batti-gtk-solved-t4662-s15.html#p48627" title="permalink">#20</a></span>

<div class="content">post18388.html#p18388</div>
</div>
</div>

</div>
</div>
<div id="p_48665" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile48665">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 604</span></div>

</div>
</div>
<span class="username">thriftee</span>
</dt>
<dd class="profile-joined">Joined: 27 Feb 2009</dd>
</dl>
<div class="postbody">
<div id="post_content48665">

<time datetime="2016-10-16T03:39">posted: 2016-10-16 &nbsp; 03:39</time>
<span class="permalink"><a href="./batti-gtk-solved-t4662-s15.html#p48665" title="permalink">#21</a></span>

<div class="content">Thanks for the ideas... I'm working on my conky script.<br>
<br>
And while I worked on the script, I failed to notice that the power plug was loose, and it drained the battery and shutdown on me. I had moved the laptop to the living room, and it came loose. The screen is small, so I run the browser and editor full screen and don't see the conky.<br>
<br>
I tried notify-send, but it doesn't work. The odd thing was that it didn't come back with an error, but didn't do anything either. I just used the simple bash script version. I'll have to read more I guess... Maybe the priority should be to find a submarine"Dive" noise to play.</div>
</div>
</div>

</div>
</div>
<div id="p_48666" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile48666">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 604</span></div>

</div>
</div>
<span class="username">thriftee</span>
</dt>
<dd class="profile-joined">Joined: 27 Feb 2009</dd>
</dl>
<div class="postbody">
<div id="post_content48666">

<time datetime="2016-10-16T06:59">posted: 2016-10-16 &nbsp; 06:59</time>
<span class="permalink"><a href="./batti-gtk-solved-t4662-s15.html#p48666" title="permalink">#22</a></span>

<div class="content">notify-send doesn't appear to work or I'm not calling it right. I used the bash example on the archwiki page. From what I could find its only used by the volumeicon and virtualbox guest, and with the volumeicon the defauly configuration doesn't use it.</div>
</div>
</div>

</div>
</div>
<div id="p_48671" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile48671">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 2,238</span></div>

</div>
</div>
<span class="username">dolphin_oracle</span>
</dt>
<dd class="profile-joined">Joined: 16 Dec 2007</dd>
</dl>
<div class="postbody">
<div id="post_content48671">

<time datetime="2016-10-16T11:33">posted: 2016-10-16 &nbsp; 11:33</time>
<span class="permalink"><a href="./batti-gtk-solved-t4662-s15.html#p48671" title="permalink">#23</a></span>

<div class="content">Notify send doesn't work in default antix. There is no notification daemon running.</div>
</div>
</div>

</div>
</div>
<div id="p_48674" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile48674">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 604</span></div>

</div>
</div>
<span class="username">thriftee</span>
</dt>
<dd class="profile-joined">Joined: 27 Feb 2009</dd>
</dl>
<div class="postbody">
<div id="post_content48674">

<time datetime="2016-10-16T16:21">posted: 2016-10-16 &nbsp; 16:21</time>
<span class="permalink"><a href="./batti-gtk-solved-t4662-s15.html#p48674" title="permalink">#24</a></span>


<div class="content">I made a bit of progress. I found that antix has notify-osd which is also used by something called unity, and there is an entry / etc/xdg/autostart/notify-osd.desktop that says to only run with certain window managers but I don't know if any of that works at all because the only one of them running is clipit, which I think I called up.<br>
<br>
Anyway, so the exec on it is <br>
/usr/lib/notify-osd/notify-osd<br>
<br>
I get warning messages, but then<br>
notify-send 'BATTERY LOW' 'Please check power' --icon=dialog-information<br>
<br>
does pop up a message box like Manjaro sends all the time. I am thinking if I can get that running in background, and get it to send 3 nasty beeps and a critical error message popup, that should do the trick. Interesting that I didn't need to load any additional software to do this.<br>
<br>
EDIT: I looked at Dave's conky and files.... There are nice tricks in the conky, which I will incorporate. I didn't understand the scripts, how they actually work, but it looks like they are setting up to draw a window for a message, but i don't see anything in them that tells the window to popup. I guess I don't know what is being used to make that work to be able to read up on it. The advantage being, it looks like the notify dameon wasn't needed to do it. I tested the lowbattery script and it does popup a window. I guess I need to figure out what is doing that and how to control it.</div>
</div>
</div>

</div>
</div>
<div id="p_48680" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile48680">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 604</span></div>

</div>
</div>
<span class="username">thriftee</span>
</dt>
<dd class="profile-joined">Joined: 27 Feb 2009</dd>
</dl>
<div class="postbody">
<div id="post_content48680">

<time datetime="2016-10-16T20:24">posted: 2016-10-16 &nbsp; 20:24</time>
<span class="permalink"><a href="./batti-gtk-solved-t4662-s15.html#p48680" title="permalink">#25</a></span>

<div class="content">Dave, could you point me to somewhere I can find documentation on how your lowbattery script works, please? What is that called? Its better than the other options like xmessage or whiptail, but I don't know where to look for a manual</div>
</div>
</div>

</div>
</div>
<div id="p_48681" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile48681">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 1,062</span></div>

</div>
</div>
<span class="username">Dave</span>
</dt>
<dd class="profile-joined">Joined: 20 Jan 2010</dd>
</dl>
<div class="postbody">
<div id="post_content48681">

<time datetime="2016-10-16T20:31">posted: 2016-10-16 &nbsp; 20:31</time>
<span class="permalink"><a href="./batti-gtk-solved-t4662-s15.html#p48681" title="permalink">#26</a></span>

<div class="content">There is no manual.<br>
I will have to write what I did and what does what.<br>
I made the little windows to prompt me instead of having a notification daemon or a power app such as xfce4-power-manager. Conky was the actual monitor that told the windows to open when the conditions were correct (battery low/ overheating). <br>
<br>
The only downside was that the program would open a hundred times if you were not careful so I think I would want to add a condition to the windows that only allowed one instance to run for for it to be sticky as on top for the window manager</div>
</div>
</div>

</div>
</div>
<div id="p_48682" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile48682">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 1,062</span></div>

</div>
</div>
<span class="username">Dave</span>
</dt>
<dd class="profile-joined">Joined: 20 Jan 2010</dd>
</dl>
<div class="postbody">
<div id="post_content48682">

<time datetime="2016-10-16T21:40">posted: 2016-10-16 &nbsp; 21:40</time>
<span class="permalink"><a href="./batti-gtk-solved-t4662-s15.html#p48682" title="permalink">#27</a></span>

<div class="content">OK,<br>
So updated low battery script
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>#!/bin/bash

MESSAGE="The System Battery is Extremely low! Shut Down Now?"
TITLE="BATTERY EXTREMELY LOW!"

FLAG_FILE="/tmp/batterylow"

if [ ! -f $FLAG_FILE ]; then
    touch $FLAG_FILE
    yad --image='error' --text="$MESSAGE" #--button='ok:0' --button='cancel:1'
    case $? in
        0)    rm $FLAG_FILE &amp;&amp; desktop-session -s    ;;
        1)    rm $FLAG_FILE &amp;&amp; exit                  ;;
        *)    echo"Not an option" &amp;&amp; exit                ;;
    esac
fi
</code></pre></div>
And updated high temperature script
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>#!/bin/bash

MESSAGE="The System Tempurature is Very High! Shut Down Now?"
TITLE="TEMPURATURE VERY HIGH!"

FLAG_FILE="/tmp/temphigh"

if [ ! -f $FLAG_FILE ]; then
    touch $FLAG_FILE
    yad --image='error' --text="$MESSAGE" #--button='ok:0' --button='cancel:1'
    case $? in
        0)    rm $FLAG_FILE &amp;&amp; desktop-session -s    ;;
        1)    rm $FLAG_FILE &amp;&amp; exit                  ;;
        *)    echo"Not an option" &amp;&amp; exit           ;;
    esac
fi
</code></pre></div>
And the part of conky to add into conky if you want the battery level to display different colors
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>${if_existing /sys/class/power_supply/AC/online 1} ## Tells if the laptop is plugged in 
${color cccccc}Charging: ${color 4afb04}${battery_bar 10,107 BAT0}  ${color 4afb04}${battery_percent BAT0}% ##Displays battery level in bar and percent in color Green
${else}${if_match ${battery_percent BAT0} &gt; 50} ## Runs if previous plugged in check says it is not plugged in and checks if battery level is over 50%
${color cccccc}Battery: ${color 4afb04}${battery_bar 10,107 BAT0}  ${color 4afb04}${battery_percent BAT0}% ##Displays battery level in bar and percent in color Green
${else}${if_match ${battery_percent BAT0} &gt; 15} ## Runs if battery level is less than 50% and checks if it is over 15%
${color cccccc}Battery: ${color fc8208}${battery_bar 10,107 BAT0}  ${color fc8208}${battery_percent BAT0}% ##Displays battery level in bar and percent in color Orange
${else}${color cccccc}Battery: ${color fd0000}${battery_bar 10,107 BAT0}  ${color fd0000}${battery_percent BAT0}%${endif}${endif}${endif} ##Runs if battery level is less than 15% and displays in color red.
</code></pre></div>
And the part of conky to add into conky if you want the battery level or temp level to start the scripts
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>${if_existing /sys/class/power_supply/AC/online 0}   ## Tells if the laptop is NOT plugged in
${if_match ${battery_percent BAT0} &lt;= 5}${execi 40 lowbattery}${endif}${endif} ## If battery level is equal to or lower than 5% display the low battery message; try every 40 seconds
${if_match ${acpitemp} &gt;= 75}${execi 40 hightemp}${endif} ## If temperature is higher than 75 'C  display high temp message; try every 40 seconds
</code></pre></div>
Place the scripts in /usr/local/bin/ and make them executable as the above conky clips are set to run the scripts as a command, where the full path is not given. If you do not want the scripts in /usr/local/bin (or on the system PATH) then give the full path the the scripts"lowbattery" and"hightemp".<br>
<br>
Also you will need to make certain that the file<br>
/sys/class/power_supply/AC/online <br>
Is an actual file. For example on my current machine the file is<br>
/sys/class/power_supply/AC0/online<br>
and on another machine the file is<br>
/sys/class/power_supply/AC1/online<br>
<br>
You could also use other files for flags / system information such as <br>
/sys/class/power_supply/BAT0/status (which displays"Charging" and"Discharging")<br>
or <br>
/sys/class/power_supply/BAT0/capacity (which displays the percentage level of the battery)<br>
<br>
You will need to explore your system a little to see what might work best for you</div>
</div>
</div>

</div>
</div>
<div id="p_48683" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile48683">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 604</span></div>

</div>
</div>
<span class="username">thriftee</span>
</dt>
<dd class="profile-joined">Joined: 27 Feb 2009</dd>
</dl>
<div class="postbody">
<div id="post_content48683">

<time datetime="2016-10-17T02:45">posted: 2016-10-17 &nbsp; 02:45</time>
<span class="permalink"><a href="./batti-gtk-solved-t4662-s15.html#p48683" title="permalink">#28</a></span>

<div class="content">Bravo! I have to say, that code looks real nice and is also very understandable. Thanks for taking time to do that...<br>
<br>
So if the message box didn't get cleared and the message is being sent again, it sees the tmp file and skips running., and on antix yad is loaded by default.<br>
<br>
I'll see if I can get it all working for here. Thanks again.<br>
<br>
I used your code and souped up my conky even more and , as well as having an ABC news feed, NWS weather conditions, 7 day forecast, calendar and the standard stuff, it now has displays what OS is running, as well as battery and CPU temp error popup messages and triple error beeps<br>
<br>
Many thanks for the code and I'll leave my versions here in case anyone else needs it. It doesn't have a tray icon this way but uses almost no memory.</div>
</div>
</div>

</div>
</div>
</div>
<div class="action-bar bar-bottom">

<div class="pagination">
28 posts
<ul>
<li class="arrow previous"><span class="jumptopagez">jump to page: </span><a class="button button-icon-only" href="./batti-gtk-solved-t4662.html" rel="prev" role="button"><span class="sr-only">Previous</span></a></li>
<li><a class="button" href="./batti-gtk-solved-t4662.html" role="button">1</a></li>
<li class="active"><span>2</span></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="scrollToTopText"><a href="#top">goto top of page</a></div>

</div>
</body></html>
