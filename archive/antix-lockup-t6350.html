<!DOCTYPE html>
<html dir="ltr" lang="en-gb">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" />
<title>antiX lockup - antiX oldforums archive</title>
   
<link rel="stylesheet" href="../aaa_style.css">
<script type="text/javascript" src ="../aaa_oldforums.js"></script>
</head>
<body>
<div id="wrap" class="wrap">
<a id="top" class="top-anchor" accesskey="t"></a>

<div id="inner-wrap">
<ul id="nav-breadcrumbs" class="nav-breadcrumbs linklist navlinks clear-after" role="menubar">
<li class="scroll-breadcrumbs breadcrumbs">
<span class="crumb"><a href="./index.html" accesskey="h" data-navbar-reference="index"><span>antiX - oldforums archive</span></a> &raquo;&raquo; </span>

<span class="crumb"><a href="./new-users-f22/index.html"><span>New Users</span></a> &raquo;&raquo; </span>

<span class="crumb"><a href="./new-users-general-questions-f16/index.html"><span>New Users &amp; General Questions</span></a></span>
</li>
</ul>

<div id="page-body" class="page-body" role="main">
<div class="postprofile_container postprofile_Left">
<div>
<div class="topictitleheader"><span class="statictopictitle">topic title: </span><span class="topic-titleb"><a href="./antix-lockup-t6350.html">antiX lockup</a></div>
<div class="pagination">
14 posts
&bull; Page <strong>1</strong> of <strong>1</strong>
</div>
</div>


<div class="viewtopic_wrapper">
<div id="p_46508" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile46508">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 14</span></div>

</div>
</div>
<span class="username">frank</span>
</dt>
<dd class="profile-joined">Joined: 31 Mar 2016</dd>
</dl>
<div class="postbody">
<div id="post_content46508">
<time datetime="2016-05-03T02:27">posted: 2016-05-03 &nbsp; 02:27</time>
<span class="permalink"><a href="./antix-lockup-t6350.html#p46508" title="permalink">#1</a></span>

<div class="content">I am running antiX 15 from a live usb with root persistence. When I place a load on the machine it seems to get into a state where the cpu is heavily used by the system. When in this state the monitor shows about 86% cpu usage with disk usage ranging 111M to 162M (approx). I ran top and found it showed the following:<br>
<br>
Tasks 188 1 running 187 sleeping 0 stopped 0 zombie<br>
%CPU .8 us 84.2 sy 0 ni 0 id 13.7 wa 0 hi 1.3 si 0 st<br>
KiB Mem 51068 total 503492 wuse 6576 free 2700 buffers<br>
KiB Swap 0 total 0 used 0 free 307932 cached Memory<br>
<br>
Any ideas on what may be causing this condition and how it can be rectified?</div>
</div>
</div>

</div>
</div>
<div id="p_46509" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile46509">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 521</span></div>

</div>
</div>
<span class="username">Shay</span>
</dt>
<dd class="profile-joined">Joined: 20 Apr 2015</dd>
</dl>
<div class="postbody">
<div id="post_content46509">

<time datetime="2016-05-03T02:44">posted: 2016-05-03 &nbsp; 02:44</time>
<span class="permalink"><a href="./antix-lockup-t6350.html#p46509" title="permalink">#2</a></span>

<div class="content">Which PID is using the most cpu?<br>
top will show you.</div>
</div>
</div>

</div>
</div>
<div id="p_46510" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile46510">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 14</span></div>

</div>
</div>
<span class="username">frank</span>
</dt>
<dd class="profile-joined">Joined: 31 Mar 2016</dd>
</dl>
<div class="postbody">
<div id="post_content46510">

<time datetime="2016-05-03T04:20">posted: 2016-05-03 &nbsp; 04:20</time>
<span class="permalink"><a href="./antix-lockup-t6350.html#p46510" title="permalink">#3</a></span>

<div class="content">Examining the php error log I find an entry just before the lock up that says:<br>
<br>
Php Warning: file_put_contents(): Only 0 bytes out of 1013 bytes written, possibly out of free disk space (entry was terminated before completing the php file that was running)<br>
<br>
Followed by:<br>
PHP Fatal Error: Out of memory (allocated 14155776) (tried to allocate 1572935 bytes)<br>
<br>
The USB stick is an 8GB stick all dedicated to antiX, so there should be ample disk space available.</div>
</div>
</div>

</div>
</div>
<div id="p_46511" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile46511">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 14</span></div>

</div>
</div>
<span class="username">frank</span>
</dt>
<dd class="profile-joined">Joined: 31 Mar 2016</dd>
</dl>
<div class="postbody">
<div id="post_content46511">

<time datetime="2016-05-03T04:23">posted: 2016-05-03 &nbsp; 04:23</time>
<span class="permalink"><a href="./antix-lockup-t6350.html#p46511" title="permalink">#4</a></span>

<div class="content">In looking at the display from top it did not appear that any process was consuming much cpu time. X was the first listing in top, which I think displays the processes in the order of their cpu usage.</div>
</div>
</div>

</div>
</div>
<div id="p_46514" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile46514">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 1,308</span></div>

</div>
</div>
<span class="username">BitJam</span>
</dt>
<dd class="profile-joined">Joined: 31 Aug 2009</dd>
</dl>
<div class="postbody">
<div id="post_content46514">

<time datetime="2016-05-03T07:28">posted: 2016-05-03 &nbsp; 07:28</time>
<span class="permalink"><a href="./antix-lockup-t6350.html#p46514" title="permalink">#5</a></span>

<div class="content"><blockquote><div><cite>frank wrote:</cite>Examining the php error log I find an entry just before the lock up that says:<br>
<br>
Php Warning: file_put_contents(): Only 0 bytes out of 1013 bytes written, possibly out of free disk space (entry was terminated before completing the php file that was running)<br>
<br>
Followed by:<br>
PHP Fatal Error: Out of memory (allocated 14155776) (tried to allocate 1572935 bytes)<br>
<br>
The USB stick is an 8GB stick all dedicated to antiX, so there should be ample disk space available.</div></blockquote>
It looks like this is more of a memory problem than a disk problem. I don't understand why it says 14 Meg were allocated when it was trying to allocate 1.5 Meg. Still, 1.5 Meg is a large chunk of RAM and it is possible there were no more free chunks of memory that large. Do a Google(/proc/buddyinfo) for more information. That file can tell you if this is the problem. Also take a look in the output of the"dmesg" command for more details.<br>
<br>
It is possible that running with dynamic root persistence contributes to the problem. You can rule this out by running with static root persistence (ideally with a usb-3.0 LiveUSB or with a frugal install on a fast drive). This will run slower but it won't touch the RAM.<br>
<br>
Writing a lot of data to the root file system when using dynamic root persistence can eat up much more RAM than is shown in many monitoring programs. The problem is that the RAM used by dynamic root persistence to hold file system changes uses tmpfs which counts as"cached" memory and most monitor programs assume all of the cached memory can be freed if needed. But cached memory used for tmpfs cannot be freed (or your tmpfs would lose files). To find out the true story, try these two commands:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code> echo 3 | sudo tee  /proc/sys/vm/drop_caches
free -m</code></pre></div>The first line frees up as much cached memory as possible. What is left in the"cached" column cannot be freed. The true amount of free memory is listed in the first line in Megabytes. Ignore the"-/+ buffers/cache" line. If you are running out of RAM and a full install or static root persistence aren't good options for you then you *might* be able to get around the problem by adding more swap space. You have to be careful though because if you are constantly swapping then that is going to slow your system to a crawl.<br>
<br>
If you have installed a lot of stuff and haven't done a live-remaster then doing a live-remaster and a reboot will free up RAM. A live-remaster will help you with things you've added to the root partition that don't need to change (much). If you need a lot of storage space on the root partition that changes as you run then try to move it somewhere else. For example, you can make a directory on the LiveUSB (mounted at /live/boot-dev) and then make a symlink from your storage directory to the directory you made. Or you can enable home persistence and make a symlink from your storage directory to a directory under /home. Storing file system changes in RAM (which is what happens with no root persistence and with dynamic root persistence) can be very fast but the trade off is it uses up RAM.</div>
</div>
</div>

</div>
</div>
<div id="p_46540" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile46540">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 14</span></div>

</div>
</div>
<span class="username">frank</span>
</dt>
<dd class="profile-joined">Joined: 31 Mar 2016</dd>
</dl>
<div class="postbody">
<div id="post_content46540">

<time datetime="2016-05-04T08:13">posted: 2016-05-04 &nbsp; 08:13</time>
<span class="permalink"><a href="./antix-lockup-t6350.html#p46540" title="permalink">#6</a></span>

<div class="content">Thank you for your assistance. Yes, it appears that the system is running out of ram. I have installed several packages, so I took your advice about creating a remastered version of the usb. Before doing so, I rebooted the computer to give it a fresh version and when I attempted the remastering it failed. I tried both compression types offered and both failed to write the .tmp file. I'm not sure how to move forward at this point???</div>
</div>
</div>

</div>
</div>
<div id="p_46541" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile46541">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 2,238</span></div>

</div>
</div>
<span class="username">dolphin_oracle</span>
</dt>
<dd class="profile-joined">Joined: 16 Dec 2007</dd>
</dl>
<div class="postbody">
<div id="post_content46541">


<time datetime="2016-05-04T11:09">posted: 2016-05-04 &nbsp; 11:09</time>
<span class="permalink"><a href="./antix-lockup-t6350.html#p46541" title="permalink">#7</a></span>

<div class="content">run with the"static" root persistence options. its slower, but it doens't load the root persistence file into ram, so you shouldn't run out.<br>
<br>
if the remaster failed, its likely due to the size of the usb stick. How big is the stick, and how big did you make the persistence files.</div>
</div>
</div>

</div>
</div>
<div id="p_46548" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile46548">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 14</span></div>

</div>
</div>
<section class="desktop-hide">
<a href="#" class="username">frank</a>  </section>
</dt>
<dd class="profile-joined">Joined: 31 Mar 2016</dd>
</dl>
<div class="postbody">
<div id="post_content46548">

<time datetime="2016-05-04T18:53">posted: 2016-05-04 &nbsp; 18:53</time>
<span class="permalink"><a href="./antix-lockup-t6350.html#p46548" title="permalink">#8</a></span>

<div class="content">I'm using an 8GB usb stick. When I enter the remaster app it says the estimated new size is 716 meg (xz) or 873 meg (gzip). It shows the boot device having 7381 meg total space with 5566 meg free and the est. remaining using gzip of 4693. When I go into the app it asks for a password but does not accept the root password, only the password for the user account. Is that normal? Logging out of the user account and trying to log in to the system as root leads nowhere. I suspect this may be what is causing the difficulty with the remastering, but I'm not sure. I'm relatively inexperienced as a linux administrator, so it may be my lack of understanding about why the password for the root account is not accepted when entering the remastering app.</div>
</div>
</div>

</div>
</div>
<div id="p_46549" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile46549">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 2,238</span></div>

</div>
</div>
<span class="username">dolphin_oracle</span>
</dt>
<dd class="profile-joined">Joined: 16 Dec 2007</dd>
</dl>
<div class="postbody">
<div id="post_content46549">

<time datetime="2016-05-04T18:56">posted: 2016-05-04 &nbsp; 18:56</time>
<span class="permalink"><a href="./antix-lockup-t6350.html#p46549" title="permalink">#9</a></span>

<div class="content"><blockquote><div><cite>frank wrote:</cite>I'm using an 8GB usb stick. When I enter the remaster app it says the estimated new size is 716 meg (xz) or 873 meg (gzip). It shows the boot device having 7381 meg total space with 5566 meg free and the est. remaining using gzip of 4693. When I go into the app it asks for a password but does not accept the root password, only the password for the user account. Is that normal? Logging out of the user account and trying to log in to the system as root leads nowhere. I suspect this may be what is causing the difficulty with the remastering, but I'm not sure. I'm relatively inexperienced as a linux administrator, so it may be my lack of understanding about why the password for the root account is not accepted when entering the remastering app.</div></blockquote>
antix is using"sudo" mode for gksu, so the user account should be the correct one.<br>
<br>
run the remaster from"static" persistence mode.</div>
</div>
</div>

</div>
</div>
<div id="p_46550" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile46550">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 14</span></div>

</div>
</div>
<span class="username">frank</span>
</dt>
<dd class="profile-joined">Joined: 31 Mar 2016</dd>
</dl>
<div class="postbody">
<div id="post_content46550">

<time datetime="2016-05-04T20:41">posted: 2016-05-04 &nbsp; 20:41</time>
<span class="permalink"><a href="./antix-lockup-t6350.html#p46550" title="permalink">#10</a></span>

<div class="content">Thanks for the help. It worked ... using static root persistence allowed the remastering to complete. I chose personal remaster to get the system that I had configured will all settings intact and when I rebooted and tried to use the system apache2 would not start. The diagnositc said it could not find /var/log/apache2/. I also checked the mysql service and it was stopped so I tried starting it and it failed, so apparently the remastering did not capture the full system correctly. Or maybe I did something wrong??? I'm not sure what else is not working as my purpose for this system is centered around apache2 and mysql. I looked for an option to rollback to the former configuration, but could not find it. Where is that located?</div>
</div>
</div>

</div>
</div>
<div id="p_46551" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile46551">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 2,238</span></div>

</div>
</div>
<span class="username">dolphin_oracle</span>
</dt>
<dd class="profile-joined">Joined: 16 Dec 2007</dd>
</dl>
<div class="postbody">
<div id="post_content46551">

<time datetime="2016-05-04T20:54">posted: 2016-05-04 &nbsp; 20:54</time>
<span class="permalink"><a href="./antix-lockup-t6350.html#p46551" title="permalink">#11</a></span>

<div class="content">use"rollback" as a boot cheatcode.<br>
<br>
However, consider that its likely the system just didn't save that particular directory (log files are usually excluded to save space). you could just remake it the directory.</div>
</div>
</div>

</div>
</div>
<div id="p_46556" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile46556">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 14</span></div>

</div>
</div>
<span class="username">frank</span>
</dt>
<dd class="profile-joined">Joined: 31 Mar 2016</dd>
</dl>
<div class="postbody">
<div id="post_content46556">

<time datetime="2016-05-05T00:29">posted: 2016-05-05 &nbsp; 00:29</time>
<span class="permalink"><a href="./antix-lockup-t6350.html#p46556" title="permalink">#12</a></span>

<div class="content">Thanks again. I did rollback to the original version. Also running with static persistence has resolved the origiinal problem I was having. Now I'd like to remaster the usb stick, but I don't know all the add-backs that I'll need to manually make to get all the installed software working again. It seems like the apache logs is just one of the places that were omitted since mysql also failed to start. Is there anyway that all of the required directories for the installed software can be retained during the remastering process. Obviously, the log files themselves need not be retained, but the directories should be so that when attempting to write logs, the services don't fail. At least I'd like to make a backup of this working version now so that if something goes wrong in the future I can roll back to the backup and move forward from there. Any ideas on how to do that? Thanks again, you all have been very helpful, and this is a very nice distribution!</div>
</div>
</div>

</div>
</div>
<div id="p_46557" class="post has-profile bg2">
<div class="inner">
<dl class="postprofile" id="profile46557">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 14</span></div>

</div>
</div>
<span class="username">frank</span>
</dt>
<dd class="profile-joined">Joined: 31 Mar 2016</dd>
</dl>
<div class="postbody">
<div id="post_content46557">

<time datetime="2016-05-05T00:35">posted: 2016-05-05 &nbsp; 00:35</time>
<span class="permalink"><a href="./antix-lockup-t6350.html#p46557" title="permalink">#13</a></span>

<div class="content">I found the luckybackup tool but it says it lets you modify essential parts of the system. Obviously that is not what I'm looking to do, so I was reluctant to use it at this point. I will do more research on that tool now.</div>
</div>
</div>

</div>
</div>
<div id="p_46561" class="post has-profile bg1">
<div class="inner">
<dl class="postprofile" id="profile46561">
<dt class="no-profile-rank has-avatar avatar-username">
<div class="avatar-username-inner">
<div class="thread-user-detail">
<div class="detail-title-numposts"><span class="detail-title-numposts">Posts: 1,308</span></div>

</div>
</div>
<span class="username">BitJam</span>
</dt>
<dd class="profile-joined">Joined: 31 Aug 2009</dd>
</dl>
<div class="postbody">
<div id="post_content46561">

<time datetime="2016-05-05 &nbsp; 07:41">posted: 2016-05-05 &nbsp; 07:41</time>
<span class="permalink"><a href="./antix-lockup-t6350.html#p46561" title="permalink">#14</a></span>

<div class="content"><blockquote><div><cite>frank wrote:</cite> Is there anyway that all of the required directories for the installed software can be retained during the remastering process. Obviously, the log files themselves need not be retained, but the directories should be so that when attempting to write logs, the services don't fail. At least I'd like to make a backup of this working version now so that if something goes wrong in the future I can roll back to the backup and move forward from there.</div></blockquote>
Unfortunately, we don't know every required file and directory for every Debian package.<br>
<br>
On the plus side, you (as the user with root privileges) can control which files get excluded when we do a live-remaster and a persist-save by editing text files in /usr/local/share/excludes. For example in the file: /usr/local/share/excludes/live-remaster-exclude.list is this line:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>live-remaster-exclude.list:var/log/!(samba)</code></pre></div>This line excludes everything in the /var/log/ directory EXCEPT the samba/ directory. You could try either deleting this line or commenting it. This will save all log files and that might be enough to let mysql work after a remaster.
<blockquote class="uncited"><div>Obviously, the log files themselves need not be retained, but the directories should be so that when attempting to write logs, the services don't fail.</div></blockquote>
Thank you for this excellent idea! We might be able to generate the /var/log/ portion of the exclude list with a find command so we exclude files but not directories. In the meantime, I hope that you will be able to get by with editing the exclude list manually.</div>
</div>
</div>

</div>
</div>
</div>
<div class="action-bar bar-bottom">

<div class="pagination">
14 posts
&bull; Page <strong>1</strong> of <strong>1</strong>
</div>
</div>
</div>
</div>
</div>
<div class="scrollToTopText"><a href="#top">goto top of page</a></div>

</div>
</body></html>
